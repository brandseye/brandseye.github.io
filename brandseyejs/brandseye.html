<!DOCTYPE html>

<html>
<head>
  <title>brandseye.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>brandseye.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*
 * Copyright (C) 2013-2014 BrandsEye (PTY) LTD
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this
 * software and associated documentation files (the "Software"), to deal in the Software
 * without restriction, including without limitation the rights to use, copy, modify,
 * merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF
 * CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="introduction">Introduction</h2>
<p><em>BrandsEye.js</em> is a simple library to help with two things:</p>
<ol>
<li>Charting. It does this by building on top of <a href="http://www.d3js.org">D3</a> and <a href="http://nvd3.org/">nvd3.js</a>.</li>
<li>Pulling data from a <a href="http://www.brandseye.com">BrandsEye</a> account.</li>
</ol>
<p>All of the charts are rendered using SVG, are animated, and provide events for showing tooltips and
providing mouse interaction. It is available at <a href="https://github.com/brandseye/brandseye.js">GitHub</a> under the MIT license. The examples directory
gives examples of the various bits in use, while this document should help with setting up
the charts.</p>
<p><em><a href="http://www.brandseye.com">BrandsEye</a></em> is an online platform for social media analysis.
It provides an <a href="https://api.brandseye.com">API</a> for accessing the data programmatically, and this library is well suited
for displaying that data. Indeed, most of the charts in the BrandsEye application are built on top of this
library.</p>
<p>This library can be divided in to two broad sections:</p>
<ol>
<li><em>The charts</em>, including bar charts, pie charts, line charts, and word clouds. These can in the most
part be used with arbitrary data.</li>
<li><em>Metrics</em>, which use the charts to display data pulled from a BrandsEye account.</li>
</ol>
<p>It’s certainly possible to use this library to display arbitrary data visually, although it was
built with the intention of displaying data from the BrandsEye <a href="https://api.brandseye.com">API</a>. Indeed, it’s used to
create many of the data visualisations offered by the BrandsEye application.</p>
<p>This document can be divided in to the following sections.</p>
<ol>
<li>A section on the <a href="#utilities">namespaces and utilities</a> provided by the library</li>
<li>A section on the the basic <a href="#graph-object">charting infrastructure</a> (a charting “parent” object).</li>
<li>Descriptions of the <a href="#charts">various charts</a> offered by the library.</li>
<li>A method showing how to <a href="#load">read data from the BrandsEye API</a>.</li>
<li>A collection of <a href="#metrics">basic metrics</a> built using the charts provided in the library,
and pulling data from the BrandsEye API.</li>
<li><a href="#appendix">Various helper objects</a> for laying out labels and legends.</li>
</ol>
<p>There are also examples available:</p>
<ul>
<li>A <a href="http://brandseye.github.io/brandseyejs/examples/simple.html">simple example</a> showing how to load a chart.</li>
<li>A <a href="http://brandseye.github.io/brandseyejs/examples/gallery.html">gallery of available charts</a>.</li>
<li>A <a href="http://brandseye.github.io/brandseyejs/examples/metrics.html">gallery of metrics</a> showing how to load
data from the BrandsEye API. These examples do require a BrandsEye API key.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><a id="utilities"></a></p>
<h2 id="namespaces-and-utilities">Namespaces and utilities</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>All of this library is contained with the <em>brandseye</em> namespace. There are a number of sub-namespaces:</p>
<ul>
<li>brandseye.colours</li>
<li>brandseye.utilities</li>
<li>brandseye.charts</li>
</ul>
<p>All of these are defined below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> brandseye = {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We version the library using <a href="http://semver.org/">semantic versioning</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    version: <span class="hljs-string">"1.0.0"</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3 id="colours">Colours</h3>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>This namespace contains the colours that we use throughout the library, although the charts have a way for
you to easily override these colour choices.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>brandseye.colours = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>brandseye.colours.scheme</strong> is our basic colour scheme.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    scheme: [
        <span class="hljs-string">'#58B6FF'</span>,
        <span class="hljs-string">'#5473BD'</span>,
        <span class="hljs-string">'#DF71FC'</span>,
        <span class="hljs-string">'#9856B0'</span>,
        <span class="hljs-string">'#ff58a3'</span>,
        <span class="hljs-string">'#D22D6F'</span>,
        <span class="hljs-string">'#fc6a4b'</span>,
        <span class="hljs-string">'#E53E39'</span>,
        <span class="hljs-string">'#FFD658'</span>,
        <span class="hljs-string">'#E8AF44'</span>,
        <span class="hljs-string">'#43C278'</span>,
        <span class="hljs-string">'#318F58'</span>
    ],</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>And <strong>brandseye.colours.allColours</strong> defines a large number of colours.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    allColours: [
        <span class="hljs-string">'#f0f8ff'</span>, <span class="hljs-string">'#faebd7'</span>, <span class="hljs-string">'#00ffff'</span>, <span class="hljs-string">'#7fffd4'</span>, <span class="hljs-string">'#f0ffff'</span>, <span class="hljs-string">'#f5f5dc'</span>, <span class="hljs-string">'#ffe4c4'</span>, <span class="hljs-string">'#000000'</span>, <span class="hljs-string">'#ffebcd'</span>, <span class="hljs-string">'#0000ff'</span>, <span class="hljs-string">'#8a2be2'</span>,
        <span class="hljs-string">'#a52a2a'</span>, <span class="hljs-string">'#deb887'</span>, <span class="hljs-string">'#5f9ea0'</span>, <span class="hljs-string">'#7fff00'</span>, <span class="hljs-string">'#d2691e'</span>, <span class="hljs-string">'#ff7f50'</span>, <span class="hljs-string">'#6495ed'</span>, <span class="hljs-string">'#fff8dc'</span>, <span class="hljs-string">'#dc143c'</span>, <span class="hljs-string">'#00ffff'</span>, <span class="hljs-string">'#00008b'</span>,
        <span class="hljs-string">'#008b8b'</span>, <span class="hljs-string">'#b8860b'</span>, <span class="hljs-string">'#a9a9a9'</span>, <span class="hljs-string">'#006400'</span>, <span class="hljs-string">'#bdb76b'</span>, <span class="hljs-string">'#8b008b'</span>, <span class="hljs-string">'#556b2f'</span>, <span class="hljs-string">'#ff8c00'</span>, <span class="hljs-string">'#9932cc'</span>, <span class="hljs-string">'#8b0000'</span>, <span class="hljs-string">'#e9967a'</span>,
        <span class="hljs-string">'#8fbc8f'</span>, <span class="hljs-string">'#483d8b'</span>, <span class="hljs-string">'#2f4f4f'</span>, <span class="hljs-string">'#00ced1'</span>, <span class="hljs-string">'#9400d3'</span>, <span class="hljs-string">'#ff1493'</span>, <span class="hljs-string">'#00bfff'</span>, <span class="hljs-string">'#696969'</span>, <span class="hljs-string">'#1e90ff'</span>, <span class="hljs-string">'#d19275'</span>, <span class="hljs-string">'#b22222'</span>,
        <span class="hljs-string">'#fffaf0'</span>, <span class="hljs-string">'#228b22'</span>, <span class="hljs-string">'#ff00ff'</span>, <span class="hljs-string">'#dcdcdc'</span>, <span class="hljs-string">'#f8f8ff'</span>, <span class="hljs-string">'#ffd700'</span>, <span class="hljs-string">'#daa520'</span>, <span class="hljs-string">'#808080'</span>, <span class="hljs-string">'#008000'</span>, <span class="hljs-string">'#adff2f'</span>, <span class="hljs-string">'#f0fff0'</span>,
        <span class="hljs-string">'#ff69b4'</span>, <span class="hljs-string">'#cd5c5c'</span>, <span class="hljs-string">'#4b0082'</span>, <span class="hljs-string">'#fffff0'</span>, <span class="hljs-string">'#f0e68c'</span>, <span class="hljs-string">'#e6e6fa'</span>, <span class="hljs-string">'#fff0f5'</span>, <span class="hljs-string">'#7cfc00'</span>, <span class="hljs-string">'#fffacd'</span>, <span class="hljs-string">'#add8e6'</span>, <span class="hljs-string">'#f08080'</span>,
        <span class="hljs-string">'#e0ffff'</span>, <span class="hljs-string">'#fafad2'</span>, <span class="hljs-string">'#d3d3d3'</span>, <span class="hljs-string">'#90ee90'</span>, <span class="hljs-string">'#ffb6c1'</span>, <span class="hljs-string">'#ffa07a'</span>, <span class="hljs-string">'#20b2aa'</span>, <span class="hljs-string">'#87cefa'</span>, <span class="hljs-string">'#8470ff'</span>, <span class="hljs-string">'#778899'</span>, <span class="hljs-string">'#b0c4de'</span>,
        <span class="hljs-string">'#ffffe0'</span>, <span class="hljs-string">'#00ff00'</span>, <span class="hljs-string">'#32cd32'</span>, <span class="hljs-string">'#faf0e6'</span>, <span class="hljs-string">'#ff00ff'</span>, <span class="hljs-string">'#800000'</span>, <span class="hljs-string">'#66cdaa'</span>, <span class="hljs-string">'#0000cd'</span>, <span class="hljs-string">'#ba55d3'</span>, <span class="hljs-string">'#9370d8'</span>, <span class="hljs-string">'#3cb371'</span>,
        <span class="hljs-string">'#7b68ee'</span>, <span class="hljs-string">'#00fa9a'</span>, <span class="hljs-string">'#48d1cc'</span>, <span class="hljs-string">'#c71585'</span>, <span class="hljs-string">'#191970'</span>, <span class="hljs-string">'#f5fffa'</span>, <span class="hljs-string">'#ffe4e1'</span>, <span class="hljs-string">'#ffe4b5'</span>, <span class="hljs-string">'#ffdead'</span>, <span class="hljs-string">'#000080'</span>, <span class="hljs-string">'#fdf5e6'</span>,
        <span class="hljs-string">'#808000'</span>, <span class="hljs-string">'#6b8e23'</span>, <span class="hljs-string">'#ffa500'</span>, <span class="hljs-string">'#ff4500'</span>, <span class="hljs-string">'#da70d6'</span>, <span class="hljs-string">'#eee8aa'</span>, <span class="hljs-string">'#98fb98'</span>, <span class="hljs-string">'#afeeee'</span>, <span class="hljs-string">'#d87093'</span>, <span class="hljs-string">'#ffefd5'</span>, <span class="hljs-string">'#ffdab9'</span>,
        <span class="hljs-string">'#cd853f'</span>, <span class="hljs-string">'#ffc0cb'</span>, <span class="hljs-string">'#dda0dd'</span>, <span class="hljs-string">'#b0e0e6'</span>, <span class="hljs-string">'#800080'</span>, <span class="hljs-string">'#ff0000'</span>, <span class="hljs-string">'#bc8f8f'</span>, <span class="hljs-string">'#4169e1'</span>, <span class="hljs-string">'#8b4513'</span>, <span class="hljs-string">'#fa8072'</span>, <span class="hljs-string">'#f4a460'</span>,
        <span class="hljs-string">'#2e8b57'</span>, <span class="hljs-string">'#fff5ee'</span>, <span class="hljs-string">'#a0522d'</span>, <span class="hljs-string">'#c0c0c0'</span>, <span class="hljs-string">'#87ceeb'</span>, <span class="hljs-string">'#6a5acd'</span>, <span class="hljs-string">'#708090'</span>, <span class="hljs-string">'#fffafa'</span>, <span class="hljs-string">'#00ff7f'</span>, <span class="hljs-string">'#4682b4'</span>, <span class="hljs-string">'#d2b48c'</span>,
        <span class="hljs-string">'#008080'</span>, <span class="hljs-string">'#d8bfd8'</span>, <span class="hljs-string">'#ff6347'</span>, <span class="hljs-string">'#40e0d0'</span>, <span class="hljs-string">'#ee82ee'</span>, <span class="hljs-string">'#d02090'</span>, <span class="hljs-string">'#f5deb3'</span>, <span class="hljs-string">'#ffffff'</span>, <span class="hljs-string">'#f5f5f5'</span>, <span class="hljs-string">'#ffff00'</span>, <span class="hljs-string">'#9acd32'</span>
    ]
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3 id="utilities">Utilities</h3>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>This provides some simple functions used throughout the library, such as tools for generating random numbers,
exporting charts as SVG, and so on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>brandseye.utilities = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h4 id="private-utility-members">Private utility members</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">var</span> attrs = {
        text: [<span class="hljs-string">'font-family'</span>, <span class="hljs-string">'font-size'</span>, <span class="hljs-string">'font-weight'</span>, <span class="hljs-string">'color'</span>, <span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'fill'</span>,
            <span class="hljs-string">'stroke'</span>, <span class="hljs-string">'stroke-width'</span>, <span class="hljs-string">'stroke-opacity'</span>, <span class="hljs-string">'line-height'</span>],
        path: [<span class="hljs-string">'stroke'</span>, <span class="hljs-string">'stroke-width'</span>, <span class="hljs-string">'stroke-opacity'</span>, <span class="hljs-string">'shape-rendering'</span>, <span class="hljs-string">'fill'</span>, <span class="hljs-string">'fill-opacity'</span>],
        rect: [<span class="hljs-string">'fill'</span>, <span class="hljs-string">'fill-opacity'</span>, <span class="hljs-string">'stroke'</span>, <span class="hljs-string">'stroke-width'</span>, <span class="hljs-string">'stroke-opacity'</span>],
        g: [<span class="hljs-string">'opacity'</span>],
        line: [<span class="hljs-string">'fill'</span>, <span class="hljs-string">'fill-opacity'</span>, <span class="hljs-string">'stroke'</span>, <span class="hljs-string">'stroke-width'</span>, <span class="hljs-string">'stroke-opacity'</span>, <span class="hljs-string">'shape-rendering'</span>]
    };

    <span class="hljs-keyword">var</span> inlineSvgCss = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
        <span class="hljs-keyword">var</span> todo = attrs[e.prop(<span class="hljs-string">"tagName"</span>)];
        <span class="hljs-keyword">if</span> (todo) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; todo.length; i++) {
                <span class="hljs-keyword">var</span> attr = todo[i];
                <span class="hljs-keyword">var</span> v = e.css(attr);
                <span class="hljs-keyword">if</span> (v) e.css(attr, v);
            }
        }
        <span class="hljs-keyword">var</span> list = e.children();
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; list.length; i++) inlineSvgCss($(list[i]));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h4 id="public-utility-members">Public utility members</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>This restricts the length of a string to the given size. This should cut text
at word boundaries, and provide ellipses when text has been shortened.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        restrictStringToLength: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(text, length)</span> {</span>
            <span class="hljs-keyword">if</span> (text.length &lt;= length) <span class="hljs-keyword">return</span> text.toString();

            <span class="hljs-keyword">var</span> result = [];
            <span class="hljs-keyword">var</span> word = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length - <span class="hljs-number">1</span>; i++) {
                <span class="hljs-keyword">var</span> character = text.charAt(i);
                <span class="hljs-keyword">if</span> (character == <span class="hljs-string">' '</span> || character == <span class="hljs-string">'\n'</span>) {
                    <span class="hljs-keyword">if</span> (result.length == <span class="hljs-number">0</span>) result = result.concat(word);
                    <span class="hljs-keyword">else</span> {
                        result.push(<span class="hljs-string">' '</span>);
                        result = result.concat(word);
                    }
                    word = [];
                } <span class="hljs-keyword">else</span> {
                    word.push(character)
                }
            }

            <span class="hljs-keyword">if</span> (text.length != <span class="hljs-number">0</span> &amp;&amp; result.length == <span class="hljs-number">0</span>) result = text; <span class="hljs-comment">/* Can happen if the string is a single word longer than length. */</span>
            <span class="hljs-keyword">else</span> result.push(<span class="hljs-string">'…'</span>);

            <span class="hljs-keyword">if</span> (result.length &gt; length) {
                <span class="hljs-keyword">return</span> result.substring(<span class="hljs-number">0</span>, length - <span class="hljs-number">1</span>) + <span class="hljs-string">'…'</span>;
            }

            <span class="hljs-keyword">return</span> result.join(<span class="hljs-string">''</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Given an svg dom element, this will return an xml representation of that
element, including have CSS styles embedded in to the xml.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        convertSvgElementToXml: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(svg)</span> {</span>
            <span class="hljs-keyword">var</span> width = svg.width();
            <span class="hljs-keyword">var</span> height = svg.height();</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The svg begins with a namespace declaration, as well as some other metadata.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            svg.attr(<span class="hljs-string">'xmlns'</span>, <span class="hljs-string">"http://www.w3.org/2000/svg"</span>);
            svg.attr(<span class="hljs-string">'width'</span>, width);
            svg.attr(<span class="hljs-string">'height'</span>, height);
            svg.attr(<span class="hljs-string">'version'</span>, <span class="hljs-string">"1.1"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Styles applied via stylesheets need to be inlined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            inlineSvgCss(svg);

            <span class="hljs-keyword">var</span> xml = svg.parent().html().trim();
            xml = xml.replace(<span class="hljs-regexp">/ class="[^"]+"/g</span>, <span class="hljs-string">''</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Extra space after some of the translate’s breaks canvg and maybe some other stuff</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            xml = xml.replace(<span class="hljs-regexp">/ transform="translate \(/g</span>, <span class="hljs-string">' transform="translate('</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Remove empty clip-path specifications, which batik, an svg parsing library, does not like</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            xml = xml.replace(<span class="hljs-regexp">/clip-path=""/g</span>, <span class="hljs-string">''</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Some paths are degenerate, and we remove their d value. Batik complains otherwise</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            xml = xml.replace(<span class="hljs-regexp">/d="MZ"/g</span>, <span class="hljs-string">''</span>);
            <span class="hljs-keyword">return</span> xml;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>This removes either single or double quotes from a string.
If quoteChar is not specified and the first character of the string is a ‘ or “ then this is used.
It will also unescape things that have been escaped inside of the string. Strings that are not quoted are
returned as-is.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        removeQuotes: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(text, quoteChar)</span> {</span>
            <span class="hljs-keyword">var</span> n = text.length - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> text;

            <span class="hljs-keyword">if</span> (!quoteChar) {
                quoteChar = text.charAt(<span class="hljs-number">0</span>);
                <span class="hljs-keyword">if</span> (quoteChar != <span class="hljs-string">'"'</span> &amp;&amp; quoteChar != <span class="hljs-string">"'"</span>) <span class="hljs-keyword">return</span> text;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (text.charAt(<span class="hljs-number">0</span>) != quoteChar) {
                <span class="hljs-keyword">return</span> text;
            }
            <span class="hljs-keyword">if</span> (text.charAt(n) != quoteChar) <span class="hljs-keyword">return</span> text;

            <span class="hljs-keyword">var</span> i = text.indexOf(<span class="hljs-string">"\\"</span>, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> text.substring(<span class="hljs-number">1</span>, n);
            <span class="hljs-keyword">var</span> o = text.substring(<span class="hljs-number">1</span>, i);
            <span class="hljs-keyword">for</span> (; i &lt; n; ) {
                <span class="hljs-keyword">var</span> c = text.charAt(i++);
                <span class="hljs-keyword">if</span> (c == <span class="hljs-string">'\\'</span>) c = text.charAt(i++);
                o += c;
            }
            <span class="hljs-keyword">return</span> o;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Often a value will be a floating point representation of a percentage, which needs
to be rounded and given the percentage symbol. This function does that.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        formatPercentage: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, round)</span> {</span>
            <span class="hljs-keyword">if</span> (round === <span class="hljs-literal">undefined</span>) round = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">var</span> base = <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, round);
            <span class="hljs-keyword">return</span> (<span class="hljs-built_in">Math</span>.round(value * base) / base).toString() + <span class="hljs-string">'%'</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Returns a pseudo-random number generator function starting with the specified seed.
Modified from: <a href="http://jacksondunstan.com/articles/393">http://jacksondunstan.com/articles/393</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        random: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(seed)</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> (seed = (seed * <span class="hljs-number">9301</span> + <span class="hljs-number">49297</span>) % <span class="hljs-number">233280</span>) / <span class="hljs-number">233280.0</span>; }
        }
    }
}();</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><a id="graph-object"></a></p>
<h2 id="the-chart-namespace">The Chart namespace</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
brandseye.charts = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h3 id="private-chart-members">Private chart members</h3>
<p>None of the following our visible outside of the namespace.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/*
     * Adds tooltips to text items that are children of the selection
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTooltips</span><span class="hljs-params">(selection, tooltips)</span> {</span>
        selection.selectAll(<span class="hljs-string">'text'</span>)
            .append(<span class="hljs-string">'title'</span>)
            .text(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">if</span> (_(tooltips).isFunction()) <span class="hljs-keyword">return</span> tooltips(d);
                <span class="hljs-keyword">return</span> tooltips &amp;&amp; _(tooltips).has(d) ? tooltips[d] : d;
            });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">overrideAxisLabels</span><span class="hljs-params">(selection, overrides)</span> {</span>
        <span class="hljs-keyword">if</span> (!overrides) <span class="hljs-keyword">return</span>;

        selection
            .selectAll(<span class="hljs-string">'text'</span>)
            .each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
                <span class="hljs-keyword">if</span> (overrides[data]) {
                    d3.select(<span class="hljs-keyword">this</span>).text(overrides[data]);
                }
            });
    }

    <span class="hljs-keyword">var</span> backgroundColour = <span class="hljs-string">'#f8f8f8'</span>;
    <span class="hljs-keyword">var</span> defaultLabelRestriction = <span class="hljs-number">15</span>;
    <span class="hljs-keyword">var</span> xAxisRestriction = <span class="hljs-number">25</span>;
    <span class="hljs-keyword">var</span> loadingText = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> dateRegex = <span class="hljs-regexp">/^\d+-\d+-\d+$/</span>;

    <span class="hljs-comment">/*
     * Attempts to limit the text of x-axis labels to an appropriate length.
     * It tries to do this with some level of aesthetic awareness, by first
     * reducing text from the kinds of labels it recognises (such as unwanted
     * information from twitter and facebook, or web urls).
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">xAxisTickFormat</span><span class="hljs-params">(restriction, text)</span> {</span>
        text = text.toString();
        <span class="hljs-keyword">if</span> (!restriction) restriction = defaultLabelRestriction;
        <span class="hljs-keyword">if</span> (text.length &lt;= restriction) <span class="hljs-keyword">return</span> text;

        <span class="hljs-keyword">var</span> facebookRegex = <span class="hljs-regexp">/^(\w+)\s+\d+$/</span>;
        <span class="hljs-keyword">var</span> twitterRegex = <span class="hljs-regexp">/^(\w+)\s+\([\w\s]+\)$/</span>;
        <span class="hljs-keyword">var</span> webpage = <span class="hljs-regexp">/^www\.(\w+)\..*$/</span>

        <span class="hljs-keyword">var</span> match;
        <span class="hljs-keyword">if</span> (match = text.match(facebookRegex)) {
            text = match[<span class="hljs-number">1</span>] + <span class="hljs-string">'…'</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (match = text.match(twitterRegex)) {
            text = match[<span class="hljs-number">1</span>] + <span class="hljs-string">'…'</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (match = text.match(webpage)) {
            text = match[<span class="hljs-number">1</span>] + <span class="hljs-string">'…'</span>;
        }

        <span class="hljs-keyword">return</span> brandseye.utilities.restrictStringToLength(text, restriction);
    }

    <span class="hljs-comment">/*
     * Marks bars with .unknown and .other classes.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">markUnknownAndOthers</span><span class="hljs-params">(selection, x, klass, extractor)</span> {</span>
        <span class="hljs-keyword">if</span> (!klass) klass = <span class="hljs-string">'.nv-bar'</span>;
        <span class="hljs-keyword">if</span> (!extractor) extractor = _.identity;
        selection.selectAll(klass).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
            d = extractor(d);
            <span class="hljs-keyword">var</span> other = <span class="hljs-literal">false</span>,
                unknown = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (_(x(d)).isString()) {
                <span class="hljs-keyword">var</span> lower = x(d).toLowerCase();
                other = lower === <span class="hljs-string">'others'</span>;
                unknown = lower === <span class="hljs-string">'unknown'</span>;
            }
            d3.select(<span class="hljs-keyword">this</span>)
                .classed(<span class="hljs-string">'other'</span>, other)
                .classed(<span class="hljs-string">'unknown'</span>, unknown);
        });
    }

    <span class="hljs-comment">/*
     * Sets up the event handlers that fire when tooltips are shown / hidden, and on mouse clicks.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupDispatcher</span><span class="hljs-params">(dispatch, container, originalDispatch, tooltipDispatch, originalData, selector, transformData)</span> {</span>
        <span class="hljs-keyword">if</span> (_(transformData).isUndefined()) transformData = _.identity;
        originalDispatch.on(<span class="hljs-string">'elementClick'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
            dispatch.elementClick(data);
        });

        tooltipDispatch.on(<span class="hljs-string">'tooltipShow'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
            dispatch.tooltipShow(data);
        });

        tooltipDispatch.on(<span class="hljs-string">'tooltipHide'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
            dispatch.tooltipHide(data);
        });

        container.selectAll(selector).on(<span class="hljs-string">'mouseup'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
            <span class="hljs-keyword">var</span> data = {
                point: transformData(d),
                e: d3.event,
                series: originalData[d.series]
            };
            <span class="hljs-keyword">if</span> (d3.event.which == <span class="hljs-number">2</span>) dispatch.elementMiddleClick(data);
            <span class="hljs-keyword">if</span> (d3.event.which == <span class="hljs-number">3</span>) dispatch.elementRightClick(data);
        });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2 id="basic-graph-functionality">Basic graph functionality</h2>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>We define all of the public interface in this alias, which we will
later assign to <strong>brandseye.charts</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Most of the graphs are built by extending the <strong>Graph</strong> object, which
defines much of the basic graphing functionality.</p>
<p>The simplest way of displaying a graph (in this case, a bar chart),
is like this:</p>
<pre><code><span class="hljs-comment">// First we define an array of x / y data points.</span>
<span class="hljs-keyword">var</span> data = [
    { x: <span class="hljs-string">"apples"</span>, y: <span class="hljs-number">10</span> },
    { x: <span class="hljs-string">"oranges"</span>, y: <span class="hljs-number">5</span>},
    { x: <span class="hljs-string">"pears"</span>, y: <span class="hljs-number">7</span>},
    { x: <span class="hljs-string">"bananas"</span>, y: <span class="hljs-number">11</span>}
];

<span class="hljs-comment">// Then we create a chart of our choice.</span>
<span class="hljs-keyword">var</span> graph = <span class="hljs-keyword">new</span> brandseye.charts.BarChart();

<span class="hljs-comment">// Then set the data and specify a dom element</span>
<span class="hljs-comment">// on which to render the data.</span>
graph
    .data(data)
    .element($(<span class="hljs-string">'.container'</span>)[<span class="hljs-number">0</span>])
    .render();
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.Graph = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3 id="graph-definition">Graph definition</h3>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><strong>Graph</strong> is defined as a collection of functions that children can override to do things
such as set up axes, display data (as bars, lines, etc.) and so on.</p>
<p>A graph has multiple elements, including the axes and their labels, the labels
on the individual data elements, and a legend.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.Graph.prototype = {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Javascript does not have a great way to provide member data
encapsulation. Here we’re placing the member data in set called attributes.
Since we want the member data to be unique to each instance, we create it here
in the constructor, rather than below in the prototype.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        createAttributes: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.attributes = {
                data: [],
                width: <span class="hljs-number">250</span>,
                height: <span class="hljs-number">250</span>,
                duration: <span class="hljs-number">250</span>,
                x: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.x; },
                y: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.y; },
                colours: brandseye.colours.scheme,
                showLegend: <span class="hljs-literal">true</span>,
                coarseness: <span class="hljs-string">'daily'</span>,
                padding: {left: <span class="hljs-number">0</span>, right: <span class="hljs-number">0</span>, bottom: <span class="hljs-number">0</span>, top: <span class="hljs-number">0</span>},
                dispatch: d3.dispatch(<span class="hljs-string">'elementClick'</span>, <span class="hljs-string">'elementMiddleClick'</span>, <span class="hljs-string">'elementRightClick'</span>, <span class="hljs-string">'tooltipShow'</span>, <span class="hljs-string">'tooltipHide'</span>),
                labelFormat: d3.format(<span class="hljs-string">',.f'</span>),
                tickFormat: d3.format(<span class="hljs-string">',.f'</span>),
                showLabels: <span class="hljs-literal">false</span>,
                zeroOpacity: <span class="hljs-number">0</span>
            };
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>This does the bulk of the work in calling the different functions that define a chart at the appropriate
times. It is the function that you should finally call when drawing a chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.setup();

            <span class="hljs-keyword">var</span> parent = d3.select(<span class="hljs-keyword">this</span>.element());

            <span class="hljs-keyword">if</span> (parent.selectAll(<span class="hljs-string">'svg'</span>).empty()) {
                parent.append(<span class="hljs-string">'svg'</span>);
            }

            <span class="hljs-keyword">var</span> svg = parent.select(<span class="hljs-string">'svg'</span>);
            <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.attributes.nvChart;

            <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
            svg
                .datum(<span class="hljs-keyword">this</span>.getDataToSet())
                .transition()
                .duration(<span class="hljs-keyword">this</span>.duration())
                .call(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection)</span> {</span>

                    that.initialiseData();
                    that.arrangeLegend(selection);
                    <span class="hljs-keyword">var</span> margins = that.calculateMargins(selection);

                    <span class="hljs-keyword">if</span> (that.dataAxisLabel() &amp;&amp; (that.labelPosition == <span class="hljs-string">"rows"</span> || that.labelPosition == <span class="hljs-string">"columns"</span>)) {
                        <span class="hljs-keyword">var</span> dataAxisLabelOffset = that.drawAxisDataLabel(selection, margins);
                        <span class="hljs-keyword">if</span> (that.labelPosition == <span class="hljs-string">"columns"</span>) margins.left = (margins.left || <span class="hljs-number">0</span>) + dataAxisLabelOffset;
                        <span class="hljs-keyword">if</span> (that.labelPosition == <span class="hljs-string">"rows"</span>) margins.bottom = (margins.bottom || <span class="hljs-number">0</span>) + dataAxisLabelOffset;
                    }

                    that.setupChart(margins);

                    <span class="hljs-keyword">if</span> (that.attributes.forceMaxY) {
                        <span class="hljs-keyword">if</span> (nvChart.forceY) nvChart.forceY([that.attributes.forceMinY, that.attributes.forceMaxY]);
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nvChart.multibar) nvChart.multibar.forceY([that.attributes.forceMinY, that.attributes.forceMaxY]);
                    }

                    that.preRenderXAxisTicks();
                    that.preRenderYAxisTicks();

                    nvChart(selection);

                    that.postRenderXAxisTicks();
                    that.postRenderYAxisTicks();

                    that.setupContainer();
                    that.arrangeTicks();
                    that.arrangeLabels(selection);

                    <span class="hljs-keyword">var</span> container = d3.select(nvChart.container);
                    setupDispatcher(that.dispatch(), container, that.graphDispatch(), nvChart.dispatch, that.data(), that.interactiveClass(), that.dataTransform);

                    <span class="hljs-keyword">if</span> (nvChart.multibar) {
                        markUnknownAndOthers(selection, that.x());
                    }
                });
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>This performs some initial setup for the first time that the chart is rendered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setup: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.attributes.hasBeenSetup) {
                <span class="hljs-keyword">this</span>.attributes.nvChart = <span class="hljs-keyword">this</span>.createChart();
                <span class="hljs-keyword">this</span>.attributes.legend = namespace.chartLegend();
                <span class="hljs-keyword">this</span>.attributes.labels = namespace.chartLabel();
            }
            <span class="hljs-keyword">this</span>.attributes.hasBeenSetup = <span class="hljs-literal">true</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Override this function to return an instance of the nvchart
that the child of <em>Graph</em> should use.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        createChart: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"createChart not implemented"</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>This method is meant to run through the data set and initialise any extra
values that might be needed. This default implementation also determines the maximum length
of labels that should be displayed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        initialiseData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.data();
            <span class="hljs-keyword">var</span> maxLabelLength = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> tickFormat = <span class="hljs-keyword">this</span>.tickFormat();

            <span class="hljs-keyword">if</span> (data) {
                _(data).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s, i)</span> {</span>
                    _(s.values).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                        d.legendKey = i;
                        <span class="hljs-keyword">var</span> length = tickFormat(d).length;
                        <span class="hljs-keyword">if</span> (length &gt; maxLabelLength) {
                            maxLabelLength = length;
                        }
                    });
                });
            }

            <span class="hljs-keyword">this</span>.attributes.maxLabelLength = maxLabelLength;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Most of the charts will want to set data in the default format.
Some, like the piechart, expect the data formatted slightly
differently. This is a great way to do whatever work needs to be done in
formatting and setting the data on the chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getDataToSet: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.data();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>A helper method for draw labels on the x axis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        drawAxisDataLabel: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection, margins)</span> {</span>
            <span class="hljs-keyword">var</span> finalHeight = <span class="hljs-number">0</span>,
                orientation = <span class="hljs-keyword">this</span>.labelPosition,
                label = <span class="hljs-keyword">this</span>.dataAxisLabel(),
                width = <span class="hljs-keyword">this</span>.width(),
                height = <span class="hljs-keyword">this</span>.height(),
                zeroOpacity = <span class="hljs-keyword">this</span>.zeroOpacity();


            margins = _.extend({
                left: <span class="hljs-number">0</span>,
                top: <span class="hljs-number">0</span>,
                bottom: <span class="hljs-number">0</span>,
                right: <span class="hljs-number">0</span>
            }, margins || {});

            <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.data();
            <span class="hljs-keyword">if</span> (data) {
                selection.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> labelSelection = d3.select(<span class="hljs-keyword">this</span>).selectAll(<span class="hljs-string">'.data-label'</span>).data([label]);
                    labelSelection.enter()
                        .append(<span class="hljs-string">'text'</span>)
                        .style(<span class="hljs-string">'opacity'</span>, zeroOpacity)
                        .classed(<span class="hljs-string">'data-label'</span>, <span class="hljs-literal">true</span>);

                    labelSelection.text(label.long);
                    <span class="hljs-keyword">var</span> bbox = labelSelection.node().getBBox();

                    <span class="hljs-keyword">if</span> (bbox.width &gt; (orientation === <span class="hljs-string">'rows'</span> ? (width - margins.left - margins.right) * <span class="hljs-number">3</span>/<span class="hljs-number">4</span> : (height - margins.bottom - margins.top) * <span class="hljs-number">3</span>/<span class="hljs-number">4</span>)) {
                        labelSelection.text(label.short);
                        bbox = labelSelection.node().getBBox();
                    }

                    <span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>,
                        y = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">var</span> buffer = orientation == <span class="hljs-string">"columns"</span> ? <span class="hljs-number">5</span> : <span class="hljs-number">0</span>;

                    <span class="hljs-keyword">if</span> (orientation == <span class="hljs-string">"rows"</span>) {
                        x = margins.left + (width - margins.left - margins.right) / <span class="hljs-number">2</span> - bbox.width / <span class="hljs-number">2</span>;
                        y = height - margins.bottom + bbox.height;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (orientation == <span class="hljs-string">"columns"</span>) {
                        x = bbox.height;
                        y = margins.top + (height - margins.bottom - margins.top) / <span class="hljs-number">2</span> + bbox.width / <span class="hljs-number">2</span>;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Unrecognised orientation ['</span> + orientation + <span class="hljs-string">']'</span>);

                    labelSelection
                        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                            <span class="hljs-keyword">var</span> translate = <span class="hljs-string">"translate("</span> + [x + buffer, y] + <span class="hljs-string">")"</span>;
                            <span class="hljs-keyword">if</span> (orientation == <span class="hljs-string">"columns"</span>) <span class="hljs-keyword">return</span> translate + <span class="hljs-string">" rotate(-90)"</span>;
                            <span class="hljs-keyword">return</span> translate;
                        })
                        .transition()
                        .duration(<span class="hljs-number">750</span>)
                        .style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">1</span>);

                    finalHeight = bbox.height + buffer;
                })
            }

            <span class="hljs-keyword">return</span> finalHeight;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>This method sets up basic properties of the chart. For example, it can set up the drawing
extants. The default versions sets up an nvd3 chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setupChart: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(margins)</span> {</span>
            <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart();

            nvChart
                .margin(margins)
                .width(<span class="hljs-keyword">this</span>.width())
                .height(<span class="hljs-keyword">this</span>.height())
                .showLegend(<span class="hljs-literal">false</span>)
                .x(<span class="hljs-keyword">this</span>.x())
                .y(<span class="hljs-keyword">this</span>.y())
                .noData(loadingText)
                .tooltips(<span class="hljs-literal">false</span>)
                .color(<span class="hljs-keyword">this</span>.colours());

            <span class="hljs-keyword">if</span> (nvChart.reduceXTicks) nvChart.reduceXTicks(<span class="hljs-literal">false</span>);
            <span class="hljs-keyword">if</span> (nvChart.showControls) nvChart.showControls(<span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>For piecharts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (nvChart.showLabels) nvChart.showLabels(<span class="hljs-literal">false</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>This is used to update the x axis before rendering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        preRenderXAxisTicks: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>And this is used to update the x axis after rendering.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        postRenderXAxisTicks: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart();
            <span class="hljs-keyword">var</span> container = d3.select(nvChart.container);
            <span class="hljs-keyword">var</span> xTicks = container.select(<span class="hljs-string">'.nv-x.nv-axis &gt; g'</span>).selectAll(<span class="hljs-string">'g'</span>);
            xTicks.selectAll(<span class="hljs-string">'text'</span>).classed(<span class="hljs-string">'x-axis-label'</span>, <span class="hljs-literal">true</span>);

            overrideAxisLabels(xTicks, <span class="hljs-keyword">this</span>.xAxisOverride());
            addTooltips(xTicks, <span class="hljs-keyword">this</span>.xAxisTooltips());
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Set up the y axis before we render the chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        preRenderYAxisTicks: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart();
            <span class="hljs-keyword">if</span> (nvChart.yAxis) {
                nvChart.yAxis
                    .tickFormat(<span class="hljs-keyword">this</span>.tickFormat())
                    .showMaxMin(<span class="hljs-literal">false</span>);
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Modify the y axis after we’ve rendered the chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        postRenderYAxisTicks: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart();
            <span class="hljs-keyword">var</span> container = d3.select(nvChart.container);
            <span class="hljs-keyword">var</span> yTicks = container.select(<span class="hljs-string">'.nv-y.nv-axis &gt; g'</span>).selectAll(<span class="hljs-string">'g'</span>);
            yTicks.selectAll(<span class="hljs-string">'text'</span>).classed(<span class="hljs-string">'y-axis-label'</span>, <span class="hljs-literal">true</span>);
            addTooltips(yTicks, <span class="hljs-keyword">this</span>.tickFormat());
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>This is a useful method to override when setting up the container
that we’re rendering to, such as its background colour, and so on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setupContainer: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart();
            <span class="hljs-keyword">var</span> xScale = nvChart.multibar.xScale();
            <span class="hljs-keyword">var</span> yScale = nvChart.multibar.yScale();
            <span class="hljs-keyword">var</span> container = d3.select(nvChart.container);
            <span class="hljs-keyword">var</span> height = <span class="hljs-built_in">Math</span>.max.apply(<span class="hljs-built_in">Math</span>.max, yScale.range()),
                width = _(xScale.rangeExtent()).last();</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>In this case, our width and height values have been swapped.
This happens, for instance, when rendering bar charts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (yScale.range()[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> tmp = height;
                height = width;
                width = tmp;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>All of our containers (usually SVG divs) are marked with the <em>.bm</em> class.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            container.classed(<span class="hljs-string">'bm'</span>, <span class="hljs-literal">true</span>);

            container.selectAll(<span class="hljs-string">'.chart-background'</span>).remove();
            container.select(<span class="hljs-string">'.nv-wrap'</span>).insert(<span class="hljs-string">'rect'</span>, <span class="hljs-string">':first-child'</span>)
                .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'chart-background'</span>)
                .attr(<span class="hljs-string">'fill'</span>, backgroundColour)
                .attr(<span class="hljs-string">'width'</span>, width)
                .attr(<span class="hljs-string">'height'</span>, height);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Used to determine how much space the chart’s legend should take.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        calculateLegendMargin: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {top: <span class="hljs-number">0</span>, left: <span class="hljs-number">60</span>, right: <span class="hljs-keyword">this</span>.width()};
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>This draws the legend on the chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        arrangeLegend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection)</span> {</span>
            <span class="hljs-keyword">this</span>.attributes.legend
                .colours(<span class="hljs-keyword">this</span>.colours())
                .margin(<span class="hljs-keyword">this</span>.calculateLegendMargin())
                .height(<span class="hljs-keyword">this</span>.height())
                .width(<span class="hljs-keyword">this</span>.width())
                .showLegend(<span class="hljs-keyword">this</span>.showLegend());
            selection.call(<span class="hljs-keyword">this</span>.attributes.legend);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>This is the default margins that the graph should have. It is used
in <em>calculateMargins()</em> to determine the true margins of the charts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        defaultMargins: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                top:    <span class="hljs-number">30</span>,
                bottom: (<span class="hljs-keyword">this</span>.coarseness() === <span class="hljs-string">'weekly'</span> ? <span class="hljs-number">45</span> : <span class="hljs-number">40</span>),
                left:   <span class="hljs-number">40</span>,
                right:  <span class="hljs-number">20</span>
            };
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Calculates the margins the chart requires, using the <em>defaultMargins()</em> of the chart.
It also takes in to account features such as the legend size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        calculateMargins: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection)</span> {</span>
            <span class="hljs-keyword">var</span> maxLabelLength = <span class="hljs-keyword">this</span>.attributes.maxLabelLength || <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> margins = <span class="hljs-keyword">this</span>.defaultMargins();
            <span class="hljs-keyword">var</span> padding = <span class="hljs-keyword">this</span>.padding();

            <span class="hljs-keyword">if</span> (maxLabelLength) margins.left = (margins.left || <span class="hljs-number">0</span>) + maxLabelLength * <span class="hljs-number">10</span>;

            margins.left += padding.left;
            margins.right += padding.right;
            margins.bottom += padding.bottom;
            margins.top += padding.top;

            margins.bottom = margins.bottom + <span class="hljs-keyword">this</span>.attributes.legend.finalHeight() + <span class="hljs-keyword">this</span>.defaultMarginBottom();

            <span class="hljs-keyword">return</span> margins;
        },

        defaultMarginBottom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-number">20</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Override to supply code that will arrange the axis bar ticks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        arrangeTicks: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            d3.select(<span class="hljs-keyword">this</span>.nvChart().container)
                .select(<span class="hljs-string">'.nv-x.nv-axis &gt; g'</span>)
                .selectAll(<span class="hljs-string">'g'</span>)
                .selectAll(<span class="hljs-string">'.tick &gt; line'</span>)
                .style(<span class="hljs-string">'opacity'</span>, <span class="hljs-keyword">this</span>.zeroOpacity());
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>This renders labels on the chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        arrangeLabels: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection)</span> {</span>
            <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart(),
                labels = <span class="hljs-keyword">this</span>.labels();

            labels
                .x(<span class="hljs-keyword">this</span>.x())
                .y(<span class="hljs-keyword">this</span>.y())
                .width(<span class="hljs-keyword">this</span>.width() - nvChart.margin().left - nvChart.margin().right)
                .height(<span class="hljs-keyword">this</span>.height())
                .xScale(nvChart.multibar.xScale())
                .yScale(nvChart.multibar.yScale())
                .delay(nvChart.delay())
                .format(<span class="hljs-keyword">this</span>.labelFormat())
                .position(<span class="hljs-keyword">this</span>.labelPosition)
                .determineCompression(<span class="hljs-keyword">this</span>.labelCompression())
                .zeroOpacity(<span class="hljs-keyword">this</span>.zeroOpacity())
                .showLabels(<span class="hljs-keyword">this</span>.showLabels());
            labels(selection);
        },

        labelPosition: <span class="hljs-string">"columns"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h3 id="getters-and-setters">Getters and Setters</h3>
<p>The getters and setters provide access to the various data elements that a graph requires.
Most of the functions below act as both getters and setters. When given an argument, they will
set the value of an item, and then return the graph object, allowing calls to be chained. When used
with no argument, they will merely return the data element.</p>
<p>An example of using this:</p>
<pre><code>   graph
       .data(data)
       .element($(<span class="hljs-string">'.graph'</span>)[<span class="hljs-number">0</span>]);
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p><strong>data()</strong> sets the data to be displayed. The data can be provided in a number of formats.
The simplest is to provide an array of objects with x / y values, like so:</p>
<pre><code>   <span class="hljs-keyword">var</span> data = [
       { x: <span class="hljs-string">"orange"</span>, y: <span class="hljs-string">"10"</span> },
       { x: <span class="hljs-string">"apple"</span>, y: <span class="hljs-string">"11"</span> },
       { x: <span class="hljs-string">"banana"</span>, y: <span class="hljs-string">"12"</span> },
   ];
   graph.data(data);
</code></pre><p>It is also possible to provide a series of comparison data, which are labeled, like so:</p>
<pre><code>   <span class="hljs-keyword">var</span> data = [{
           key: <span class="hljs-string">"Fruit"</span>,
           values: [
               { x: <span class="hljs-string">"apples"</span>, y: <span class="hljs-number">10</span> },
               { x: <span class="hljs-string">"oranges"</span>, y: <span class="hljs-number">5</span>},
               { x: <span class="hljs-string">"pears"</span>, y: <span class="hljs-number">7</span>},
               { x: <span class="hljs-string">"bananas"</span>, y: <span class="hljs-number">11</span>}
           ]
       },
       {
           key: <span class="hljs-string">"Herb"</span>,
           values: [
               { x: <span class="hljs-string">"Thyme"</span>, y: <span class="hljs-number">10</span> },
               { x: <span class="hljs-string">"Rosemary"</span>, y: <span class="hljs-number">5</span>},
               { x: <span class="hljs-string">"Sage"</span>, y: <span class="hljs-number">7</span>},
               { x: <span class="hljs-string">"Taragon"</span>, y: <span class="hljs-number">11</span>}
           ]
       }
   ];
   graph.data(data);
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>        data: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.data;
            <span class="hljs-keyword">if</span> (data &amp;&amp; !data.length) data = [data];
            <span class="hljs-keyword">if</span> (data &amp;&amp; data[<span class="hljs-number">0</span>].key === <span class="hljs-literal">undefined</span>) {
                data = [{
                    key: <span class="hljs-string">"series 1"</span>,
                    values: data
                }];
            }

            <span class="hljs-keyword">this</span>.attributes.data = data || [];
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Sets the element in which the graph should be displayed. This
should be native dom element (rather than a jquery or d3 selection).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        element: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.element;
            <span class="hljs-keyword">this</span>.attributes.element = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Gets the underlying nvd3 (or other element) used to create this chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        nvChart: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.nvChart;
        },

        width: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.width;
            <span class="hljs-keyword">this</span>.attributes.width = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },

        height: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.height;
            <span class="hljs-keyword">this</span>.attributes.height = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p><strong>x()</strong> and <strong>y()</strong> specify how to obtain the <em>x</em> and <em>y</em> components
from the individual data values. They default to returning the values for keys
names x (or similarly y) from the data. The default implementations are equivalent to this:</p>
<pre><code>   graph
       .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.x; })
       .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.y; });
</code></pre><p>These should be set to obtain the appropriate data from your own data set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        x: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.x;
            <span class="hljs-keyword">this</span>.attributes.x = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },

        y: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.y;
            <span class="hljs-keyword">this</span>.attributes.y = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Pass this a function to provide formatting of x axis values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        tickFormat: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.tickFormat;
            <span class="hljs-keyword">this</span>.attributes.tickFormat = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Pass a function to format data labels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        labelFormat: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.labelFormat;
            <span class="hljs-keyword">this</span>.attributes.labelFormat = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },

        labelCompression: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.labelCompression;
            <span class="hljs-keyword">this</span>.attributes.labelCompression = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Set to true / false depending on whether you want to show or hide the labels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showLabels: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.showLabels;
            <span class="hljs-keyword">this</span>.attributes.showLabels = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Provides access to the element that draws the labels on the charts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        labels: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.labels;
        },

        tooltip: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>If you need the <em>y</em>-axis to cover a particular range, pass this function an
array containing the minimum and maximum range.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        forceY: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(force)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.attributes.forceMinY, <span class="hljs-keyword">this</span>.attributes.forceMaxY];
            <span class="hljs-keyword">if</span> (_.isArray(force)) {
                <span class="hljs-keyword">this</span>.attributes.forceMinY = force[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">this</span>.attributes.forceMaxY = force[<span class="hljs-number">1</span>];
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">this</span>.attributes.forceMinY = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">this</span>.attributes.forceMaxY = force;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Pass this an array of values to use for the <em>x</em>-axis tooltips.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        xAxisTooltips: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.xAxisTooltips;
            <span class="hljs-keyword">this</span>.attributes.xAxisTooltips = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>This allows you to override the display values for <em>x</em>-axis components.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        xAxisOverride: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.xAxisOverride;
            <span class="hljs-keyword">this</span>.attributes.xAxisOverride = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>An array of colours to be used by the graph. For most graphs, this is the colour per data series.
For the pie chart, this would be the colour per slice.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        colours: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.colours;
            <span class="hljs-keyword">this</span>.attributes.colours = (_ &amp;&amp; _.length) ? _.concat(brandseye.colours.allColours) : brandseye.colours.allColours;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Of use for the histogram. It defines the time period of the <em>x</em>-axis. It may be set to:</p>
<ul>
<li>weekly</li>
<li>monthly</li>
<li>yearly</li>
<li>daily</li>
</ul>
<p>and defaults to daily.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        coarseness: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.coarseness;
            <span class="hljs-keyword">this</span>.attributes.coarseness = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Set to true / false whether the legend should be shown or hidden.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showLegend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.showLegend;
            <span class="hljs-keyword">this</span>.attributes.showLegend = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Use this to provide a label for the numerical data axis of the chart. This can
either be a string, or it could be a map providing an option of a longer or shorter
string depending on the amount of available space:</p>
<pre><code>{
  long: <span class="hljs-string">"Percentage of global fruit output by country"</span>,
  short: <span class="hljs-string">"% output"</span>
}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>        dataAxisLabel: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(label)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.dataAxisLabel;
            <span class="hljs-keyword">if</span> (_(label).isString()) label = { long: label, short: label };
            <span class="hljs-keyword">this</span>.attributes.dataAxisLabel = label;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>By default, the library will use an opacity of zero to make things
invisible. Unfortunately, in some situations (for instance, when
using this library in jsdom) this opacity value is not always applied properly.
In that case, you can choose a custom value to use here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        zeroOpacity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.zeroOpacity;
            <span class="hljs-keyword">this</span>.attributes.zeroOpacity = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>The graphs are animated, and this is how long they should be animated for, in milliseconds.
This defaults to 250.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        duration: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.duration;
            <span class="hljs-keyword">this</span>.attributes.duration = _;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>A map giving the amount of space to be added around the chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        padding: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.padding;
            <span class="hljs-keyword">this</span>.attributes.padding = {
                top:    _.top || <span class="hljs-number">0</span>,
                bottom: _.bottom || <span class="hljs-number">0</span>,
                left:   _.left || <span class="hljs-number">0</span>,
                right:  _.right || <span class="hljs-number">0</span>
            };
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Provides access to a <a href="https://github.com/mbostock/d3/wiki/Internals#wiki-events">d3 event dispatch object</a>,
for handling events fired by the graph. The following events are supported:</p>
<ul>
<li><em>elementClick</em>. Fired when elements, such as bars, are left clicked once.</li>
<li><em>elementMiddleClick</em>. Fired when elements, such as bars, are middle clicked.</li>
<li><em>elementRightClick</em>. Fired when elements, such as bars, are right clicked once.</li>
<li><em>tooltipShow</em>. Fired when it is appropriate to show a tooltip.</li>
<li><em>tooltipHide</em>. Fired when a tooltip should be hidden.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dispatch: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.dispatch;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Returns the <a href="https://github.com/mbostock/d3/wiki/Internals#wiki-events">d3 dispatch</a> associated with
the underlying graph element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        graphDispatch: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart();
            <span class="hljs-keyword">if</span> (nvChart.multibar) <span class="hljs-keyword">return</span> nvChart.multibar.dispatch;
            <span class="hljs-keyword">if</span> (nvChart.pie) <span class="hljs-keyword">return</span> nvChart.pie.dispatch;
            <span class="hljs-keyword">if</span> (nvChart.lines) <span class="hljs-keyword">return</span> nvChart.lines.dispatch;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Unable to determine graph dispatch"</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>This is the class of the item that should be interactive in the graph, such as bars or pie slices.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        interactiveClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">'.nv-bar'</span>;
        },

        dataTransform: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
            <span class="hljs-keyword">return</span> data;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p><a id="charts"></a></p>
<h2 id="the-charts">The Charts</h2>

            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <h3 id="histograms">Histograms</h3>

            </div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>The histogram is useful for accumulating discrete values in to buckets,
such as for showing the number of mentions appearing over time.</p>
<p>This is how a histogram appears:</p>
<p><img src="http://brandseye.github.io/brandseyejs/images/histogram.png" alt="Histogram example"></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.Histogram = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        namespace.Graph.prototype.createAttributes.call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.Histogram.prototype = <span class="hljs-keyword">new</span> namespace.Graph();
    namespace.Histogram.prototype.createChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> nv.models.multiBarChart(); };

    namespace.Histogram.prototype.arrangeTicks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> seen = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

        <span class="hljs-keyword">var</span> container = d3.select(<span class="hljs-keyword">this</span>.nvChart().container);
        <span class="hljs-keyword">var</span> xTicks = container.select(<span class="hljs-string">'.nv-x.nv-axis &gt; g'</span>).selectAll(<span class="hljs-string">'g'</span>);
        <span class="hljs-keyword">var</span> xScale = <span class="hljs-keyword">this</span>.nvChart().multibar.xScale();

        <span class="hljs-keyword">var</span> isMonday = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
            <span class="hljs-keyword">return</span> m.day() === <span class="hljs-number">1</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Here, if there are comparisons, we want to map label dates to lists of comparison dates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> comparisons = {};
        <span class="hljs-keyword">if</span> (that.data() &amp;&amp; that.data().length &gt; <span class="hljs-number">1</span>) {
            _(that.data()).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> {</span>
                _(s.values).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    <span class="hljs-keyword">if</span> (d.originalPublished) {
                        <span class="hljs-keyword">var</span> dates = comparisons[d.published] || [];
                        dates.push(d.originalPublished);
                        comparisons[d.published] = dates;
                    }
                });
            });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>We don’t want to include any duplicate dates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _(comparisons).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dates, key)</span> {</span>
            comparisons[key] = _(dates).uniq();
        });

        xTicks
            .selectAll(<span class="hljs-string">'text'</span>)
            .classed(<span class="hljs-string">'x-axis-label'</span>, <span class="hljs-literal">true</span>)
            .each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, position)</span> {</span>
                <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> moment(data);
                <span class="hljs-keyword">var</span> formatString = <span class="hljs-string">'dddd, MMMM D, YYYY'</span>;

                <span class="hljs-comment">/* TODO There is a bug that makes the data and text elements repeat itself with position always equal to 0. When this begins, data will be null. */</span>
                <span class="hljs-keyword">if</span> (!data || seen) {
                    seen = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-comment">/* TODO sometimes we should rotate nothing, if the rangeBand is large enough. */</span>
                <span class="hljs-keyword">var</span> rotate = xScale.rangeBand() / that.data().length &lt; <span class="hljs-number">20</span> ||
                    that.longFormat(m, position) || isMonday(m) ||
                    _(that.data()).any(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.values[<span class="hljs-number">0</span>].published === data;});
                <span class="hljs-keyword">var</span> angle = that.coarseness() === <span class="hljs-string">'monthly'</span> || that.coarseness() === <span class="hljs-string">'weekly'</span> ? -<span class="hljs-number">30</span> : -<span class="hljs-number">90</span>;
                <span class="hljs-keyword">var</span> yOffset = that.coarseness() === <span class="hljs-string">'monthly'</span> || that.coarseness() === <span class="hljs-string">'weekly'</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">5</span>;

                d3.select(<span class="hljs-keyword">this</span>)
                    .style(<span class="hljs-string">'text-anchor'</span>, rotate ? <span class="hljs-string">'end'</span> : <span class="hljs-string">'middle'</span>)
                    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                        <span class="hljs-keyword">if</span> (!d || that.coarseness() !== <span class="hljs-string">'daily'</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Here we want to see if this is the beginning of a month</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (m.month() === <span class="hljs-number">0</span> &amp;&amp; m.date() === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"year-begin"</span>;
                        <span class="hljs-keyword">if</span> (m.date() == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"month-begin"</span>;
                        <span class="hljs-keyword">if</span> (m.day() == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"week-begin"</span>;
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"standard-day"</span>;
                    })
                    .attr(<span class="hljs-string">'transform'</span>, rotate ? <span class="hljs-string">'translate (-10, '</span> + yOffset + <span class="hljs-string">') rotate('</span> + angle + <span class="hljs-string">' 0,0)'</span> : <span class="hljs-string">''</span>)
                    .append(<span class="hljs-string">'title'</span>)
                    .text(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                        <span class="hljs-keyword">if</span> (_(comparisons).isEmpty() || !comparisons[d]) {
                            <span class="hljs-keyword">switch</span> (that.coarseness()) {
                                <span class="hljs-keyword">case</span> <span class="hljs-string">'weekly'</span>:
                                    <span class="hljs-keyword">return</span> <span class="hljs-string">'The week of '</span> + m.format(formatString) + <span class="hljs-string">', to '</span>
                                        + m.clone().add(<span class="hljs-string">'days'</span>, <span class="hljs-number">6</span>).format(formatString);
                                <span class="hljs-keyword">case</span> <span class="hljs-string">'monthly'</span>:
                                    <span class="hljs-keyword">return</span> <span class="hljs-string">'The month of '</span> + m.format(<span class="hljs-string">'MMMM'</span>);
                                <span class="hljs-keyword">case</span> <span class="hljs-string">'yearly'</span>:
                                    <span class="hljs-keyword">return</span> <span class="hljs-string">'The year '</span> + m.format(<span class="hljs-string">'YYYY'</span>);
                                <span class="hljs-keyword">case</span> <span class="hljs-string">'daily'</span>:
                                <span class="hljs-keyword">default</span>:
                                    <span class="hljs-keyword">return</span> m.format(formatString);
                            }
                        }
                        <span class="hljs-keyword">var</span> dates = comparisons[d];
                        <span class="hljs-keyword">var</span> format = <span class="hljs-string">'ddd MMM D, YYYY'</span>;
                        <span class="hljs-keyword">var</span> first = <span class="hljs-keyword">new</span> moment(dates[<span class="hljs-number">0</span>]).format(format);
                        <span class="hljs-keyword">return</span> _(comparisons[d]).chain()
                            .drop(<span class="hljs-number">1</span>)
                            .reduce(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(memo, date)</span> {</span>
                                <span class="hljs-keyword">return</span> memo + <span class="hljs-string">"\nvs\n"</span> + <span class="hljs-keyword">new</span> moment(date).format(format);
                            }, first)
                            .value();
                    });
            });

        <span class="hljs-keyword">if</span> (that.data()) {
            <span class="hljs-keyword">if</span> (xScale.rangeBand() &lt; <span class="hljs-number">12</span>) {
                xTicks.selectAll(<span class="hljs-string">'text'</span>)
                    .classed(<span class="hljs-string">'smaller-text'</span>, <span class="hljs-literal">true</span>);
            }
            <span class="hljs-keyword">if</span> (xScale.rangeBand() &lt; <span class="hljs-number">10</span>) {
                xTicks.selectAll(<span class="hljs-string">'.standard-day'</span>)
                    .style(<span class="hljs-string">'opacity'</span>, that.zeroOpacity());
            }
        }

        xTicks.selectAll(<span class="hljs-string">'.tick &gt; line'</span>).style(<span class="hljs-string">'opacity'</span>, <span class="hljs-keyword">this</span>.zeroOpacity());
    };

    namespace.Histogram.prototype.preRenderXAxisTicks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart();
        <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

        <span class="hljs-keyword">if</span> (nvChart.xAxis) {
            nvChart.xAxis.tickFormat(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i)</span> {</span>
                <span class="hljs-keyword">if</span> (!dateRegex.test(d)) <span class="hljs-keyword">return</span> d;
                <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> moment(d);

                <span class="hljs-keyword">switch</span> (that.coarseness()) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">'daily'</span>:
                        <span class="hljs-keyword">if</span> (that.longFormat(m, i)) <span class="hljs-keyword">return</span> m.format(<span class="hljs-string">"MMM DD"</span>);
                        <span class="hljs-keyword">if</span> (m.day() === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> m.format(<span class="hljs-string">"ddd DD"</span>);

                        <span class="hljs-keyword">return</span> m.format(<span class="hljs-string">"DD"</span>);
                    <span class="hljs-keyword">case</span> <span class="hljs-string">'weekly'</span>:
                        <span class="hljs-keyword">var</span> next = m.clone().add(<span class="hljs-string">'days'</span>, <span class="hljs-number">6</span>),
                            label = m.format(<span class="hljs-string">"MMM DD"</span>) + <span class="hljs-string">'→'</span>;
                        <span class="hljs-keyword">if</span> (next.months() === m.months()) label += next.format(<span class="hljs-string">"DD"</span>);
                        <span class="hljs-keyword">else</span> label += next.format(<span class="hljs-string">"MMM DD"</span>);
                        <span class="hljs-keyword">return</span> label;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">'monthly'</span>:
                        <span class="hljs-keyword">if</span> (m.month() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> m.format(<span class="hljs-string">"MMMM ’YY"</span>);
                        <span class="hljs-keyword">return</span> m.format(<span class="hljs-string">"MMMM"</span>);
                    <span class="hljs-keyword">case</span> <span class="hljs-string">'yearly'</span>:
                        <span class="hljs-keyword">return</span> m.format(<span class="hljs-string">"YYYY"</span>);
                }
            });
        }
    };

    namespace.Histogram.prototype.postRenderXAxisTicks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> };</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Returns true if we should format this date long, rather than just
with the date.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.Histogram.prototype.longFormat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m, i)</span> {</span> <span class="hljs-keyword">return</span> i === <span class="hljs-number">0</span> || m.date() === <span class="hljs-number">1</span>; };</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <h3 id="bar-charts">Bar charts</h3>

            </div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p><em>Bar charts</em> are useful for comparing categories of things. Bar charts
are rendered horizontally: if you would like vertical bars, see the <em>ColumnChart</em>.</p>
<p>A bar chart appears like so:</p>
<p><img src="http://brandseye.github.io/brandseyejs/images/bar-chart.png" alt="Bar chart example"></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.BarChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        namespace.Graph.prototype.createAttributes.call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.BarChart.prototype = <span class="hljs-keyword">new</span> namespace.Graph();
    namespace.BarChart.prototype.createChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> nv.models.multiBarHorizontalChart(); };
    namespace.BarChart.prototype.labelPosition = <span class="hljs-string">"rows"</span>;

    namespace.BarChart.prototype.initialiseData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.data(),
            xAxisOverride = <span class="hljs-keyword">this</span>.xAxisOverride(),
            xAxisRestriction = <span class="hljs-number">25</span>,
            maxLabelLength = <span class="hljs-number">0</span>,
            x = <span class="hljs-keyword">this</span>.x();

        <span class="hljs-keyword">if</span> (data) {
            _(data).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s, i)</span> {</span>
                _(s.values).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    d.legendKey = i;
                    <span class="hljs-keyword">var</span> item = x(d);
                    <span class="hljs-keyword">if</span> (xAxisOverride &amp;&amp; xAxisOverride[item]) item = xAxisOverride[item];
                    <span class="hljs-keyword">var</span> length = xAxisTickFormat(xAxisRestriction, item.toString()).length;
                    <span class="hljs-keyword">if</span> (length &gt; maxLabelLength) {
                        maxLabelLength = length;
                    }
                });
            });
        }

        <span class="hljs-keyword">this</span>.attributes.maxLabelLength = maxLabelLength;
    };

    namespace.BarChart.prototype.calculateLegendMargin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> {top: <span class="hljs-number">0</span>, left: <span class="hljs-number">30</span>, right: <span class="hljs-keyword">this</span>.width()};
    };

    namespace.BarChart.prototype.calculateMargins = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection)</span> {</span>
        <span class="hljs-keyword">var</span> margins = {left: <span class="hljs-number">30</span>, right: <span class="hljs-number">30</span>, top: <span class="hljs-number">20</span>, bottom: <span class="hljs-number">20</span>},
            padding = <span class="hljs-keyword">this</span>.padding();
        <span class="hljs-keyword">var</span> maxLabelLength = <span class="hljs-keyword">this</span>.attributes.maxLabelLength || <span class="hljs-number">0</span>;

        margins.bottom = (margins.bottom || <span class="hljs-number">0</span>) + <span class="hljs-keyword">this</span>.attributes.legend.finalHeight() + <span class="hljs-number">20</span>;

        <span class="hljs-keyword">if</span> (maxLabelLength) {
            margins.left = maxLabelLength * <span class="hljs-number">8</span>; <span class="hljs-comment">// Budgeting a set pixel width per letter (innacurate because not-fixed width font in use)</span>
        }

        margins.left += padding.left;
        margins.right += padding.right;
        margins.bottom += padding.bottom;
        margins.top += padding.top;

        <span class="hljs-keyword">return</span> margins;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <h3 id="column-charts">Column charts</h3>

            </div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p><em>Column charts</em> are useful for comparing categories of things. Column charts
are rendered vertically: if you would like horizontal bars, see the <em>BarChart</em>.</p>
<p>This is an example of a column chart:
<img src="http://brandseye.github.io/brandseyejs/images/column-chart.png" alt="Histogram example"></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.ColumnChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        namespace.Graph.prototype.createAttributes.call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.ColumnChart.prototype = <span class="hljs-keyword">new</span> namespace.Graph();
    namespace.ColumnChart.prototype.createChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> nv.models.multiBarChart(); };

    namespace.ColumnChart.prototype.initialiseData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.data();

        <span class="hljs-keyword">if</span> (data) {
            <span class="hljs-keyword">var</span> xAxisOverride = <span class="hljs-keyword">this</span>.xAxisOverride(),
                x = <span class="hljs-keyword">this</span>.x(),
                y = <span class="hljs-keyword">this</span>.y(),
                tickFormat = <span class="hljs-keyword">this</span>.tickFormat(),
                maxXLabelLength = <span class="hljs-number">0</span>,
                maxYLabelLength = <span class="hljs-number">0</span>;

            _(data).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s, i)</span> {</span>
                _(s.values).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Store an index for legends.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    d.legendKey = i;</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Determine length for x axis</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> item = x(d);
                    <span class="hljs-keyword">if</span> (xAxisOverride &amp;&amp; xAxisOverride[item]) item = xAxisOverride[item];
                    <span class="hljs-keyword">var</span> length = xAxisTickFormat(xAxisRestriction, item.toString()).length;
                    <span class="hljs-keyword">if</span> (length &gt; maxXLabelLength) {
                        maxXLabelLength = length;
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Determine length for y axis</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    item = tickFormat(y(d));
                    length = item.toString().length;
                    <span class="hljs-keyword">if</span> (length &gt; maxYLabelLength) {
                        maxYLabelLength = length;
                    }
                });
            });

            <span class="hljs-keyword">this</span>.attributes.maxXLabelLength = maxXLabelLength;
            <span class="hljs-keyword">this</span>.attributes.maxYLabelLength = maxYLabelLength;
        }
    };

    namespace.ColumnChart.prototype.postRenderXAxisTicks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> nvChart = <span class="hljs-keyword">this</span>.nvChart(),
            xAxisOverride = <span class="hljs-keyword">this</span>.xAxisOverride(),
            container = d3.select(nvChart.container),
            xTicks = container.select(<span class="hljs-string">'.nv-x.nv-axis &gt; g'</span>).selectAll(<span class="hljs-string">'g'</span>);

        container.select(<span class="hljs-string">'.nv-x.nv-axis &gt; g'</span>).selectAll(<span class="hljs-string">'g'</span>).selectAll(<span class="hljs-string">'text'</span>)
            .filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> d != <span class="hljs-literal">null</span> &amp;&amp; ((xAxisOverride &amp;&amp; xAxisOverride[d] &amp;&amp; xAxisOverride[d].length &gt; <span class="hljs-number">2</span>) || d.toString().length &gt; <span class="hljs-number">2</span> )
            })
            .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'end'</span>)
            .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate(-30 0,0)'</span>);

        overrideAxisLabels(xTicks, <span class="hljs-keyword">this</span>.xAxisOverride());
        addTooltips(xTicks, <span class="hljs-keyword">this</span>.xAxisTooltips());
    };

    namespace.ColumnChart.prototype.calculateLegendMargin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> { top: <span class="hljs-number">0</span>, left: <span class="hljs-keyword">this</span>.nvChart().margin().left, right: <span class="hljs-keyword">this</span>.width() };
    };

    namespace.ColumnChart.prototype.calculateMargins = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> margins = nv.models.multiBarChart().margin(),
            padding = <span class="hljs-keyword">this</span>.padding();
        margins = {
            top: margins.top,
            bottom: margins.bottom,
            left: margins.left,
            right: margins.right
        };
        <span class="hljs-keyword">var</span> maxXLabelLength = <span class="hljs-keyword">this</span>.attributes.maxXLabelLength || <span class="hljs-number">0</span>,
            maxYLabelLength = <span class="hljs-keyword">this</span>.attributes.maxYLabelLength || <span class="hljs-number">0</span>;

        margins.bottom = (margins.bottom || <span class="hljs-number">0</span>) + <span class="hljs-keyword">this</span>.attributes.legend.finalHeight();

        <span class="hljs-keyword">if</span> (maxXLabelLength) {</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Budgeting a set pixel width per letter (innacurate because not-fixed width font in use)
This may be an odd number because the labels are rotated.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            margins.bottom = (margins.bottom || <span class="hljs-number">0</span>) + maxXLabelLength * <span class="hljs-number">3</span>;
        }

        <span class="hljs-keyword">if</span> (maxYLabelLength) {
            margins.left = (margins.left || <span class="hljs-number">0</span>) + maxYLabelLength * <span class="hljs-number">3</span>;
        }

        margins.left += padding.left;
        margins.right += padding.right;
        margins.bottom += padding.bottom;
        margins.top += padding.top;

        <span class="hljs-keyword">return</span> margins;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <h3 id="pie-charts">Pie charts</h3>

            </div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>This is an example of a pie chart
<img src="http://brandseye.github.io/brandseyejs/images/pie-chart.png" alt="Pie chart example"></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.PieChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        namespace.Graph.prototype.createAttributes.call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.PieChart.prototype = <span class="hljs-keyword">new</span> namespace.Graph();
    namespace.PieChart.prototype.createChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> nv.models.pieChart(); };
    namespace.PieChart.prototype.labelPosition = <span class="hljs-string">"circle"</span>;

    namespace.PieChart.prototype.getDataToSet = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.data();
        <span class="hljs-keyword">if</span> (data &amp;&amp; data.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.data()[<span class="hljs-number">0</span>].values;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> data;
    };

    namespace.PieChart.prototype.initialiseData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.data(),
            xAxisOverride = <span class="hljs-keyword">this</span>.xAxisOverride(),
            x = <span class="hljs-keyword">this</span>.x();

        <span class="hljs-keyword">if</span> (data) {
            _(data).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                _(d.values).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i)</span> {</span>
                    d.legendKey = i;
                })
            });

            <span class="hljs-keyword">if</span> (data &amp;&amp; data.length) {
                <span class="hljs-keyword">this</span>.attributes.labelItems = _(data[<span class="hljs-number">0</span>].values).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    <span class="hljs-keyword">var</span> item = x(d);
                    <span class="hljs-keyword">if</span> (xAxisOverride &amp;&amp; xAxisOverride[item]) item = xAxisOverride[item];
                    <span class="hljs-keyword">return</span> { key: item };
                });
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.attributes.labelItems = [];

        }
    };

    namespace.PieChart.prototype.defaultMargins = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> { top: <span class="hljs-number">0</span>, bottom: <span class="hljs-number">0</span>, left: <span class="hljs-number">0</span>, right: <span class="hljs-number">0</span> }
    };

    namespace.PieChart.prototype.defaultMarginBottom = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    };

    namespace.PieChart.prototype.arrangeLegend = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection)</span> {</span>
        <span class="hljs-keyword">this</span>.attributes.legend
            .data(<span class="hljs-keyword">this</span>.attributes.labelItems)
            .colours(<span class="hljs-keyword">this</span>.colours())
            .margin({top: <span class="hljs-number">0</span>, left: <span class="hljs-number">30</span>, right: <span class="hljs-keyword">this</span>.width()})
            .height(<span class="hljs-keyword">this</span>.height())
            .width(<span class="hljs-keyword">this</span>.width())
            .showLegend(<span class="hljs-keyword">this</span>.showLegend())
            .forceLegend(<span class="hljs-literal">true</span>);
        selection.call(<span class="hljs-keyword">this</span>.attributes.legend);
    };

    namespace.PieChart.prototype.setupContainer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection)</span> {</span>
        d3.select(<span class="hljs-keyword">this</span>.nvChart().container)
            .classed(<span class="hljs-string">'bm'</span>, <span class="hljs-literal">true</span>);
    };

    namespace.PieChart.prototype.arrangeLabels = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selection)</span> {</span>
        <span class="hljs-keyword">var</span> labels = <span class="hljs-keyword">this</span>.labels(),
            nvChart = <span class="hljs-keyword">this</span>.nvChart();

        labels.x(<span class="hljs-keyword">this</span>.x())
            .y(<span class="hljs-keyword">this</span>.y())
            .width(<span class="hljs-keyword">this</span>.width() - nvChart.margin().left - nvChart.margin().right)
            .height(<span class="hljs-keyword">this</span>.height() - nvChart.margin().top - nvChart.margin().bottom)
            .format(<span class="hljs-keyword">this</span>.labelFormat())
            .position(<span class="hljs-string">"circle"</span>)
            .determineCompression(<span class="hljs-keyword">this</span>.labelCompression())
            .zeroOpacity(<span class="hljs-keyword">this</span>.zeroOpacity())
            .showLabels(<span class="hljs-keyword">this</span>.showLabels());
        labels(selection);
    };

    namespace.PieChart.prototype.interactiveClass = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">'.nv-slice'</span>;
    };

    namespace.PieChart.prototype.dataTransform = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
        <span class="hljs-keyword">return</span> data.data;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <h3 id="line-charts">Line charts</h3>

            </div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>This shows timeseries data. Expects the <em>x</em>-axis to show dates.</p>
<p>This is an example of a line chart:
<img src="http://brandseye.github.io/brandseyejs/images/line-chart.png" alt="Line chart example"></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.LineChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        namespace.Graph.prototype.createAttributes.call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.LineChart.prototype = <span class="hljs-keyword">new</span> namespace.Graph();
    namespace.LineChart.prototype.createChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> nv.models.lineChart(); };

    namespace.LineChart.prototype.setupContainer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> };
    namespace.LineChart.prototype.arrangeLabels = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> };

    namespace.LineChart.prototype.initialiseData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        namespace.Graph.prototype.initialiseData.apply(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.data();
        <span class="hljs-keyword">var</span> chartX = <span class="hljs-keyword">this</span>.x();
        <span class="hljs-keyword">var</span> rewriteX = <span class="hljs-literal">false</span>;

        _(data).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> {</span>
            _(s.values).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">if</span> (_(chartX(d)).isString()) {
                    d.publishedStamp =  <span class="hljs-keyword">new</span> moment(chartX(d)).unix();
                    rewriteX = <span class="hljs-literal">true</span>;
                }
            })
        });

        <span class="hljs-keyword">if</span> (rewriteX) {
            chartX = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> d.publishedStamp;
            }
        }

        <span class="hljs-keyword">this</span>.attributes.chartX = chartX;
    };

    namespace.LineChart.prototype.setupChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(margins)</span> {</span>
        <span class="hljs-keyword">this</span>.nvChart()
            .margin(margins)
            .width(<span class="hljs-keyword">this</span>.width())
            .height(<span class="hljs-keyword">this</span>.height())
            .showLegend(<span class="hljs-literal">false</span>)
            .x(<span class="hljs-keyword">this</span>.attributes.chartX)
            .y(<span class="hljs-keyword">this</span>.y())
            .noData(loadingText)
            .tooltips(<span class="hljs-literal">false</span>)
            .color(<span class="hljs-keyword">this</span>.colours());

        <span class="hljs-keyword">this</span>.nvChart().xScale(d3.time.scale());
    };

    namespace.LineChart.prototype.preRenderXAxisTicks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> chartX = <span class="hljs-keyword">this</span>.attributes.chartX,
            x = <span class="hljs-keyword">this</span>.x();

        <span class="hljs-keyword">this</span>.nvChart().xAxis.tickFormat(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i)</span> {</span>
            <span class="hljs-keyword">if</span> (!dateRegex.test(d) &amp;&amp; chartX === x) <span class="hljs-keyword">return</span> d;
            <span class="hljs-keyword">var</span> m = chartX === x ? <span class="hljs-keyword">new</span> moment(d) : moment.unix(d);
            <span class="hljs-keyword">return</span> m.format(<span class="hljs-string">"MMM DD"</span>);
        });
    };
    namespace.LineChart.prototype.postRenderXAxisTicks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>};

    namespace.LineChart.prototype.arrangeTicks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.data(),
            nvChart = <span class="hljs-keyword">this</span>.nvChart(),
            chartX = <span class="hljs-keyword">this</span>.attributes.chartX,
            x = <span class="hljs-keyword">this</span>.x();

        <span class="hljs-keyword">var</span> comparisons = {};
        <span class="hljs-keyword">if</span> (data &amp;&amp; data.length &gt; <span class="hljs-number">1</span>) {
            _(data).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> {</span>
                _(s.values).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    <span class="hljs-keyword">if</span> (d.originalPublished) {
                        <span class="hljs-keyword">var</span> dates = comparisons[d.published] || [];
                        dates.push(d.originalPublished);
                        comparisons[d.published] = dates;
                    }
                });
            });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>We don’t want to include any duplicate dates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _(comparisons).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dates, key)</span> {</span>
            comparisons[key] = _(dates).uniq();
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Now we want to rotate and translate the labels appropriately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> seen = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> container = d3.select(nvChart.container);

        <span class="hljs-keyword">var</span> xTicks = container.select(<span class="hljs-string">'.nv-x.nv-axis &gt; g'</span>).selectAll(<span class="hljs-string">'g'</span>);
        xTicks
            .selectAll(<span class="hljs-string">'text'</span>)
            .classed(<span class="hljs-string">'x-axis-label'</span>, <span class="hljs-literal">true</span>)
            .each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, position)</span> {</span>
                <span class="hljs-keyword">var</span> m = chartX === x ? <span class="hljs-keyword">new</span> moment(data) : moment.unix(data);
                <span class="hljs-keyword">var</span> formatString = <span class="hljs-string">'dddd, MMMM D, YYYY'</span>;

                <span class="hljs-comment">/* TODO There is a bug that makes the data and text elements repeat itself with position always equal to 0. When this begins, data will be null. */</span>
                <span class="hljs-keyword">if</span> (!data || seen) {
                    seen = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-comment">/* TODO sometimes we should rotate nothing, if the rangeBand is large enough. */</span>
                <span class="hljs-keyword">var</span> angle = -<span class="hljs-number">30</span>;
                <span class="hljs-keyword">var</span> yOffset = <span class="hljs-number">0</span>;

                d3.select(<span class="hljs-keyword">this</span>)
                    .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'end'</span>)
                    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'translate (-20, '</span> + yOffset + <span class="hljs-string">') rotate('</span> + angle + <span class="hljs-string">' 0,0)'</span>)
                    .append(<span class="hljs-string">'title'</span>)
                    .text(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                        <span class="hljs-keyword">if</span> (_(comparisons).isEmpty() || !comparisons[d]) {
                            <span class="hljs-keyword">return</span> m.format(formatString);
                        }
                        <span class="hljs-keyword">var</span> dates = comparisons[d];
                        <span class="hljs-keyword">var</span> format = <span class="hljs-string">'ddd MMM D, YYYY'</span>;
                        <span class="hljs-keyword">var</span> first = <span class="hljs-keyword">new</span> moment(dates[<span class="hljs-number">0</span>]).format(format);
                        <span class="hljs-keyword">return</span> _(comparisons[d]).chain()
                            .drop(<span class="hljs-number">1</span>)
                            .reduce(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(memo, date)</span> {</span>
                                <span class="hljs-keyword">return</span> memo + <span class="hljs-string">"\nvs\n"</span> + <span class="hljs-keyword">new</span> moment(date).format(format);
                            }, first)
                            .value();
                    });
            });

        xTicks.selectAll(<span class="hljs-string">'.tick &gt; line'</span>).style(<span class="hljs-string">'opacity'</span>, <span class="hljs-keyword">this</span>.zeroOpacity());

        container.selectAll(<span class="hljs-string">'.nv-axisMaxMin text'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, position)</span> {</span>
            d3.select(<span class="hljs-keyword">this</span>)
                .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'end'</span>)
                .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate(-30, 0,0)'</span>);
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <h3 id="word-clouds">Word Clouds</h3>

            </div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>While this chart uses a similar interface to the previous charts, its expected data format is different,
as is the kind of data that it displays.</p>
<p>The word cloud is animated and laid out using a layout written for D3 by <a href="https://github.com/jasondavies/d3-cloud">Jason Davies</a>, available
at github under a BSD license. We’ve supplied our own copy in the lib directory, which we’ve patched slightly
to support setting a seed for the random number generator. This provides a great feature: if you find a
layout that you like, you can effectively save and replay that.</p>
<p>If you want to stop the animation, call the <strong>stop()</strong> method.</p>
<p>This is an example of a word cloud:</p>
<p><img src="http://brandseye.github.io/brandseyejs/images/word-cloud.png" alt="Histogram example"></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.WordCloudChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        namespace.Graph.prototype.createAttributes.call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">this</span>.attributes.seed = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10000</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Unlike the other graphs, the default fields for retrieving data for word clouds
is <em>word</em> and <em>count</em>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.attributes.x = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.word; };
        <span class="hljs-keyword">this</span>.attributes.y = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.count; };
        <span class="hljs-keyword">this</span>.attributes.font = <span class="hljs-string">'sans-serif'</span>;
        <span class="hljs-keyword">this</span>.attributes.layout = <span class="hljs-string">'archimedean'</span>;
        <span class="hljs-keyword">this</span>.attributes.minFont = <span class="hljs-number">9</span>;
        <span class="hljs-keyword">this</span>.attributes.maxFont = <span class="hljs-number">70</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.WordCloudChart.prototype = <span class="hljs-keyword">new</span> namespace.Graph();
    namespace.WordCloudChart.prototype.createChart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> d3.layout.cloud(); };

    namespace.WordCloudChart.prototype.setupContainer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.attributes.parent.classed(<span class="hljs-string">'bm'</span>, <span class="hljs-literal">true</span>)
    };
    namespace.WordCloudChart.prototype.arrangeLabels = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> };

    namespace.WordCloudChart.prototype.data = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.data;
        <span class="hljs-keyword">this</span>.attributes.data = data || [];
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.WordCloudChart.prototype.render = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.setup();
        <span class="hljs-keyword">var</span> parent = <span class="hljs-keyword">this</span>.attributes.parent = d3.select(<span class="hljs-keyword">this</span>.element());
        <span class="hljs-keyword">this</span>.setupContainer();

        <span class="hljs-keyword">if</span> (parent.selectAll(<span class="hljs-string">'svg'</span>).empty()) {
            parent.append(<span class="hljs-string">'svg'</span>).append(<span class="hljs-string">'g'</span>);
        }

        <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">this</span>.x(),
            y = <span class="hljs-keyword">this</span>.y(),
            width = <span class="hljs-keyword">this</span>.width(),
            height = <span class="hljs-keyword">this</span>.height();

        <span class="hljs-keyword">var</span> svg = <span class="hljs-keyword">this</span>.attributes.svg = parent.select(<span class="hljs-string">'svg'</span>);

        svg
            .select(<span class="hljs-string">"g"</span>)
            .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"translate("</span> + [ <span class="hljs-built_in">Math</span>.floor(width / <span class="hljs-number">2</span>), <span class="hljs-built_in">Math</span>.floor(height / <span class="hljs-number">2</span>) ] + <span class="hljs-string">")"</span>);

        <span class="hljs-keyword">var</span> cloud = <span class="hljs-keyword">this</span>.attributes.nvChart;

        <span class="hljs-keyword">var</span> fontSize;
        <span class="hljs-keyword">switch</span>(<span class="hljs-keyword">this</span>.attributes.scale) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'linear'</span>:
                fontSize = d3.scale.linear(); <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'square'</span>:
                fontSize = d3.scale.sqrt(); <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'log'</span>:
            <span class="hljs-keyword">default</span>:
                fontSize = d3.scale.log();
        }

        <span class="hljs-keyword">var</span> words = <span class="hljs-keyword">this</span>.getDataToSet();
        <span class="hljs-keyword">var</span> min = <span class="hljs-literal">Infinity</span>,
            max = -<span class="hljs-literal">Infinity</span>;
        _(words).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
            <span class="hljs-keyword">if</span> (y(d) &lt; min) min = y(d);
            <span class="hljs-keyword">if</span> (y(d) &gt; max) max = y(d);
        });

        fontSize.domain([min, max]).range([<span class="hljs-keyword">this</span>.attributes.minFont, <span class="hljs-keyword">this</span>.attributes.maxFont]);

        <span class="hljs-keyword">var</span> font = <span class="hljs-keyword">this</span>.attributes.font;

        cloud
            .random(brandseye.utilities.random(<span class="hljs-keyword">this</span>.seed()))
            .spiral(<span class="hljs-keyword">this</span>.attributes.layout)
            .size([width, height])
            .timeInterval(<span class="hljs-number">10</span>)
            .text(x)
            .fontSize(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> fontSize(y(d)); })
            .font(font)
            .rotate(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; })
            .padding(<span class="hljs-literal">true</span>)
            .on(<span class="hljs-string">"end"</span>, _.bind(<span class="hljs-keyword">this</span>.layoutComplete, <span class="hljs-keyword">this</span>))
            .words(words)
            .start();

    };</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>This is called after the words have been laid out by the layout
algorithm. It places the words in the svg container
and lays them out.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.WordCloudChart.prototype.layoutComplete = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(words)</span> {</span>
        <span class="hljs-keyword">var</span> wordToCount = {};
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.getDataToSet();
        <span class="hljs-keyword">if</span> (!data.length) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">this</span>.x(),
            y = <span class="hljs-keyword">this</span>.y();

        _(data).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
            wordToCount[x(d)] = y(d);
        });

        <span class="hljs-keyword">var</span> dispatch = <span class="hljs-keyword">this</span>.dispatch();

        <span class="hljs-keyword">var</span> text = <span class="hljs-keyword">this</span>.attributes.svg.select(<span class="hljs-string">'g'</span>).selectAll(<span class="hljs-string">"text"</span>).data(words);
        text.exit().remove();
        text.enter()
            .append(<span class="hljs-string">"text"</span>)
            .classed(<span class="hljs-string">'word'</span>, <span class="hljs-literal">true</span>)
            .attr(<span class="hljs-string">"text-anchor"</span>, <span class="hljs-string">"middle"</span>)
            .on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> dispatch.elementClick(d); });

        text
            .text(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.text; })
            .style(<span class="hljs-string">'font-family'</span>, <span class="hljs-keyword">this</span>.font())
            .on(<span class="hljs-string">'mouseover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> dispatch.tooltipShow(d); })
            .on(<span class="hljs-string">'mouseout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> dispatch.tooltipHide(d); });

        text
            .transition()
            .duration(<span class="hljs-number">1000</span>)
            .style(<span class="hljs-string">"font-size"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> d.size + <span class="hljs-string">"px"</span>;
            })
            .style(<span class="hljs-string">"fill"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d, i)</span> {</span>
                <span class="hljs-keyword">return</span> brandseye.colours.scheme[i % brandseye.colours.scheme.length];
            })
            .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">"translate("</span> + [d.x, d.y] + <span class="hljs-string">")rotate("</span> + d.rotate + <span class="hljs-string">")"</span>;
            });
    };

    namespace.WordCloudChart.prototype.layout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.layout;
        <span class="hljs-keyword">this</span>.attributes.layout = _;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>This determines how the different fonts should be scaled to one another.
There are three choices (specified as a string):</p>
<ul>
<li><em>linear</em>: word sizes are in a direct linear relationship based on their count.</li>
<li><em>square</em>: word sizes are related by the square root of their counts.</li>
<li><em>log</em>: word sizes are related logarithmically by their counts.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.WordCloudChart.prototype.scale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.scale;
        <span class="hljs-keyword">this</span>.attributes.scale = _;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.WordCloudChart.prototype.minFont = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.minFont;
        <span class="hljs-keyword">this</span>.attributes.minFont = _;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    namespace.WordCloudChart.prototype.maxFont = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.maxFont;
        <span class="hljs-keyword">this</span>.attributes.maxFont = _;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Sets the font to be used for sizing information. This defaults
to sans-serif. Please ensure to use the same font as you would when
rendering the cloud, otherwise you will notice rendering problems, such
as overlapping words, large spaces between words, and so on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.WordCloudChart.prototype.font = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.font;
        <span class="hljs-keyword">this</span>.attributes.font = _;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>This seed value is used to determine the sequence of random values that are used when
laying out the words. If you would like to use the same layout, use the same seed as previously used.
Each new instance of <em>WordCloudChart</em> will have a seed initialised to a random value by default.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.WordCloudChart.prototype.seed = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes.seed;
        <span class="hljs-keyword">this</span>.attributes.seed = _;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>This stops the animation of the word cloud.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.WordCloudChart.prototype.stop = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.attributes.nvChart) <span class="hljs-keyword">this</span>.attributes.nvChart.stop();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <h2 id="charts-not-inheriting-from-graph">Charts not inheriting from Graph</h2>
<p>We have two charts that don’t follow the standard chart API: <em>sparklines</em> and <em>area</em>.</p>

            </div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <h3 id="sparklines">Sparklines</h3>

            </div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>A sparkline draws a small line without axes or labels. It’s a great way to show the outline
of a data set inside of a text area, such as in a paragraph.</p>
<p>An example of it in use:</p>
<pre><code><span class="hljs-comment">/* Define the area in which to draw the sparkline */</span>
.sparkline {
   width: <span class="hljs-number">100</span>px;
   height: <span class="hljs-number">1</span>em;
}

<span class="hljs-comment">// Provide the element and the data</span>
brandseye.charts.Sparkline($(<span class="hljs-string">'.sparkline'</span>)[<span class="hljs-number">0</span>], [
    {x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>},
    {x: <span class="hljs-number">1</span>, y: <span class="hljs-number">2</span>},
    {x: <span class="hljs-number">2</span>, y: <span class="hljs-number">1</span>},
    {x: <span class="hljs-number">3</span>, y: <span class="hljs-number">3</span>},
    {x: <span class="hljs-number">4</span>, y: <span class="hljs-number">5</span>},
    {x: <span class="hljs-number">5</span>, y: <span class="hljs-number">0</span>}
]);
</code></pre><p>Sparklines appear like so:</p>
<p><img src="http://brandseye.github.io/brandseyejs/images/sparkline.png" alt="sparkline example"></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    namespace.Sparkline = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector, data, x, y)</span> {</span>
        x = x || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.x; };
        y = y || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.y; };

        <span class="hljs-keyword">var</span> $main = $(selector);
        <span class="hljs-keyword">if</span> (!$(<span class="hljs-string">'svg'</span>, $main).length) {
            $main.html(<span class="hljs-string">'&lt;svg&gt;&lt;/svg&gt;'</span>);
        }

        <span class="hljs-keyword">var</span> width = $main.width();
        <span class="hljs-keyword">var</span> height = $main.height();

        <span class="hljs-keyword">var</span> svg = d3.select($main[<span class="hljs-number">0</span>]).select(<span class="hljs-string">'svg'</span>);
        svg
            .attr(<span class="hljs-string">'width'</span>, width)
            .attr(<span class="hljs-string">'height'</span>, height)
            .classed(<span class="hljs-string">'bm'</span>, <span class="hljs-literal">true</span>)
            .classed(<span class="hljs-string">'chart-sparkline'</span>, <span class="hljs-literal">true</span>);

        <span class="hljs-keyword">var</span> minX = x(_(data).min(x));
        <span class="hljs-keyword">var</span> maxX = x(_(data).max(x));
        <span class="hljs-keyword">var</span> minY = y(_(data).min(y));
        <span class="hljs-keyword">var</span> maxY = y(_(data).max(y));

        <span class="hljs-keyword">var</span> xScale = d3.scale.linear().domain([minX, maxX]).range([<span class="hljs-number">0</span>, width]);
        <span class="hljs-keyword">var</span> yScale = d3.scale.linear().domain([minY, maxY]).range([height, <span class="hljs-number">0</span>]);

        <span class="hljs-keyword">var</span> line = d3.svg.line()
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> xScale(x(d));
            })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> yScale(y(d));
            })
            .interpolate(<span class="hljs-string">'linear'</span>);

        <span class="hljs-keyword">var</span> lines = svg.selectAll(<span class="hljs-string">'.bm-chart-sparkline-line'</span>).data([data]);
        lines.exit().remove();
        lines.enter().append(<span class="hljs-string">'path'</span>).classed(<span class="hljs-string">'bm-chart-sparkline-line'</span>, <span class="hljs-literal">true</span>);

        lines.attr(<span class="hljs-string">'d'</span>, line);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <h3 id="area-charts">Area charts</h3>

            </div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Similar to sparklines, these also colour the area under the chart.</p>
<p>The example is almost identical to the sparkline example. Do remember to
define the width and height in css of the item you are drawing to.</p>
<pre><code><span class="hljs-comment">// Provide the element and the data</span>
brandseye.charts.Area($(<span class="hljs-string">'.area'</span>)[<span class="hljs-number">0</span>], [
    {x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>},
    {x: <span class="hljs-number">1</span>, y: <span class="hljs-number">2</span>},
    {x: <span class="hljs-number">2</span>, y: <span class="hljs-number">1</span>},
    {x: <span class="hljs-number">3</span>, y: <span class="hljs-number">3</span>},
    {x: <span class="hljs-number">4</span>, y: <span class="hljs-number">5</span>},
    {x: <span class="hljs-number">5</span>, y: <span class="hljs-number">0</span>}
]);
</code></pre><p>Area charts appear like so:</p>
<p><img src="http://brandseye.github.io/brandseyejs/images/area-chart.png" alt="Area chart example"></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.Area = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector, data, x, y)</span> {</span>
        x = x || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.x; };
        y = y || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.y; };

        <span class="hljs-keyword">var</span> $main = $(selector);
        <span class="hljs-keyword">if</span> (!$(<span class="hljs-string">'svg'</span>, $main).length) {
            $main.html(<span class="hljs-string">'&lt;svg&gt;&lt;/svg&gt;'</span>);
        }

        <span class="hljs-keyword">var</span> width = $main.width();
        <span class="hljs-keyword">var</span> height = $main.height();

        <span class="hljs-keyword">var</span> svg = d3.select($main[<span class="hljs-number">0</span>]).select(<span class="hljs-string">'svg'</span>);
        svg
            .attr(<span class="hljs-string">'width'</span>, width)
            .attr(<span class="hljs-string">'height'</span>, height)
            .classed(<span class="hljs-string">'bm'</span>, <span class="hljs-literal">true</span>)
            .classed(<span class="hljs-string">'chart-sparkline'</span>, <span class="hljs-literal">true</span>);

        <span class="hljs-keyword">var</span> minX = x(_(data).min(x));
        <span class="hljs-keyword">var</span> maxX = x(_(data).max(x));
        <span class="hljs-keyword">var</span> minY = y(_(data).min(y));
        <span class="hljs-keyword">var</span> maxY = y(_(data).max(y));

        <span class="hljs-keyword">var</span> xScale = d3.scale.linear().domain([minX, maxX]).range([<span class="hljs-number">0</span>, width]);
        <span class="hljs-keyword">var</span> yScale = d3.scale.linear().domain([minY, maxY]).range([height, <span class="hljs-number">0</span>]);

        <span class="hljs-keyword">var</span> area = d3.svg.area()
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> xScale(x(d));
            })
            .y0(height)
            .y1(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> yScale(y(d));
            });

        <span class="hljs-keyword">var</span> areas = svg.selectAll(<span class="hljs-string">'.bm-chart-sparkline-area'</span>).data([data]);
        areas.exit().remove();
        areas.enter()
            .append(<span class="hljs-string">'path'</span>)
            .classed(<span class="hljs-string">'bm-chart-sparkline-area'</span>, <span class="hljs-literal">true</span>)
            .style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">0</span>)
            .transition()
            .duration(<span class="hljs-number">1000</span>)
            .style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">1.0</span>);

        areas.attr(<span class="hljs-string">'d'</span>, area);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p><a id="load"></a></p>
<h2 id="reading-data-from-the-api">Reading data from the API</h2>

            </div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>The address of the BrandsEye API server is <a href="https://api.brandseye.com">https://api.brandseye.com</a>. This is a restful,
json api. You can visit the page to view the documentation on the api. When asked for a username / password,
you can use your, you can use the username API_KEY and use your api key as the password.
Please contact your client service representative if you need to find out what your api key is.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.brandsEyeApi = <span class="hljs-string">"https://api.brandseye.com"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p><strong>loadFromApi()</strong> is a helper function to load data from the api. You very likely would want
to only use this when testing the library, as it will expose your api key in your
client side code. By default it will return data from the <em>count</em> endpoint of the BrandsEye API,
although that can be overridden using the <em>fragment</em> option below.</p>
<p>The function takes a number of possible arguments.</p>
<ul>
<li><em>username</em>: username for accessing the data server (see the <em>key</em> option below).</li>
<li><em>password</em>: password for accessing the data server (see the <em>key</em> option below).</li>
<li><em>server</em>: an optional argument for the server to use. If not filled in, the default BrandsEye API server will be used.</li>
<li><em>key</em>: An api key to use instead of a username/password pair.</li>
<li><em>max</em>: An integer giving the maximum number of items to show (optional).</li>
<li><em>showOthers</em>: A boolean, default true, used in conjunction with max above. If true, those items
not shown because they exceed the max field will be rolled in to an <em>Other</em> field.</li>
<li><em>xFieldName</em>: The name of the field in which the x value is stored. This is needed when showing others.</li>
<li><em>fragment</em>: Optional string. Apart from providing an account code, you may provide a whole fragment string
representing the API endpoint that you wish to access. For example, rest/accounts/QUIR01BA/mentions/ots</li>
<li><em>groupby</em>: An optional string of comma separated values for grouping the resulting data.</li>
<li><em>orderby</em>: An optional string of comma separated values for ordering the resulting data.</li>
<li><em>arguments</em>: An optional map of extra arguments to append to the url.</li>
<li><em>callback</em>: a function that will be called on success. It will be passed the data returned from the API.</li>
<li><em>error</em>: An optional function called on failure.</li>
</ul>
<p>An example of its use:</p>
<pre><code>brandseye.charts.loadFromApi({
    key: "your key,
    account: "your account code",
    filter: "published inthelast week and sentiment &gt; 1",
    groupby: "published",
    success: function(data) { console.log("Received", data); }
});
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
    namespace.loadFromApi = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        <span class="hljs-keyword">if</span> (!options.account &amp;&amp; !options.fragment) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Please specify an account"</span>);
        }

        <span class="hljs-keyword">var</span> username = options.username || <span class="hljs-string">"API_KEY"</span>,
            password = options.password || options.key,
            server = options.server || namespace.brandsEyeApi,
            callback = options.success,
            authorisation = <span class="hljs-string">"Basic "</span> + btoa(username + <span class="hljs-string">":"</span> + password),
            fragment = options.fragment || <span class="hljs-string">"rest/accounts/"</span> + options.account + <span class="hljs-string">"/mentions/count"</span>;

        <span class="hljs-keyword">if</span> (options.showOthers === <span class="hljs-literal">undefined</span>) options.showOthers = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (options.max &amp;&amp; options.showOthers) options.max = options.max - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (options.max &amp;&amp; options.showOthers &amp;&amp; !options.xFieldName) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"xFieldName must be set when showing Other values"</span>);

        <span class="hljs-keyword">var</span> <span class="hljs-built_in">arguments</span> = [];
        <span class="hljs-built_in">arguments</span>.push(<span class="hljs-string">"Authorization="</span> + authorisation);
        <span class="hljs-keyword">if</span> (options.arguments) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> options.arguments) {
                <span class="hljs-built_in">arguments</span>.push(key + <span class="hljs-string">"="</span> + <span class="hljs-built_in">encodeURIComponent</span>(options.arguments[key]));
            }
        }

        <span class="hljs-keyword">if</span> (options.groupby) <span class="hljs-built_in">arguments</span>.push(<span class="hljs-string">"groupby="</span> + <span class="hljs-built_in">encodeURIComponent</span>(options.groupby));
        <span class="hljs-keyword">if</span> (options.filter) <span class="hljs-built_in">arguments</span>.push(<span class="hljs-string">"filter="</span> + <span class="hljs-built_in">encodeURIComponent</span>(options.filter));
        <span class="hljs-keyword">if</span> (options.orderby) <span class="hljs-built_in">arguments</span>.push(<span class="hljs-string">"orderby="</span> + <span class="hljs-built_in">encodeURIComponent</span>(options.orderby));
        <span class="hljs-keyword">if</span> (options.include) <span class="hljs-built_in">arguments</span>.push(<span class="hljs-string">"include="</span> + <span class="hljs-built_in">encodeURIComponent</span>(options.include));

        <span class="hljs-keyword">var</span> url = server + <span class="hljs-string">"/"</span> + fragment + <span class="hljs-string">"?"</span> + <span class="hljs-built_in">arguments</span>.join(<span class="hljs-string">'&amp;'</span>);

        <span class="hljs-keyword">return</span> $.ajax({
            url: url,
            contentType: <span class="hljs-string">"application/json"</span>,
            dataType: <span class="hljs-string">'jsonp'</span>,
            success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span>{</span>
                <span class="hljs-keyword">if</span> (data.status === <span class="hljs-number">401</span>) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"You are not authorised to access this endpoint"</span>);
                }
                <span class="hljs-keyword">if</span> (data.status) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(data.error);
                }
                <span class="hljs-keyword">if</span> (options.max) {
                    <span class="hljs-keyword">var</span> originalData = data;
                    data = _(data).take(options.max);
                    <span class="hljs-keyword">if</span> (options.showOthers) {
                        <span class="hljs-keyword">var</span> others = _.chain(originalData)
                            .rest(options.max)
                            .reduce(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(memo, num)</span> {</span>
                                <span class="hljs-keyword">return</span> {
                                    count: memo.count + (num.count || <span class="hljs-number">0</span>),
                                    ave: memo.ave + (num.ave || <span class="hljs-number">0</span>),
                                    ots: memo.ots + (num.ots || <span class="hljs-number">0</span>),
                                    percentage: memo.percentage + (num.percentage || <span class="hljs-number">0</span>),
                                    credibility: memo.credibility + (num.credibility || <span class="hljs-number">0</span>)
                                };
                            }, {count: <span class="hljs-number">0</span>, ave: <span class="hljs-number">0</span>, ots: <span class="hljs-number">0</span>, percentage: <span class="hljs-number">0</span>, credibility: <span class="hljs-number">0</span>, reach: <span class="hljs-number">0</span>, engagement: <span class="hljs-number">0</span>})
                            .value();
                        others[options.xFieldName] = <span class="hljs-string">"Others"</span>;
                        data.push(others);
                    }
                }
                callback(data);
            },
            error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (options.error) options.error();
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"There was an error communicating with the API"</span>);
            }
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p><a id="metrics"></a></p>
<h2 id="the-metrics">The Metrics</h2>
<p>This section creates various example metrics. All of these can be used in your application,
or can be used to show how to pull appropriate data from the <a href="https://api.brandseye.com">BrandsEye API</a>.
They are quite simple implementations, however, and don’t directly
support various features such as comparison data sets (multiple series),</p>
<h3 id="support-objects-brandseyemetric">Support objects: BrandsEyeMetric</h3>

            </div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>This provides a way of easily defining graphs that query the <a href="https://api.brandseye.com">BrandsEye API</a> and hence
have a lot of shared boilerplate code in terms of setting up the call to the API and then displaying
the data. This function has a way to set up a query on a particular account, initialises the graph
with the appropriate type, and then provides easy access to the graph in order to customise it.
There are various examples below of this happening.</p>
<p>The <strong>loadFromApi()</strong> function is defined further below.</p>
<p>Showing a metric is simple:</p>
<pre><code><span class="hljs-comment">// Define the account, api key, and filter to use</span>
<span class="hljs-keyword">var</span> metric = <span class="hljs-keyword">new</span> brandseye.charts.VolumeMetric({
    account: <span class="hljs-string">"BEMF33AA"</span>,
    key: <span class="hljs-string">'your api key'</span>,
    filter: <span class="hljs-string">"published inthelast week"</span>
});

<span class="hljs-comment">// Specify the element's height/width and supply</span>
<span class="hljs-comment">// a dom object to render to.</span>
metric
    .element(element)
    .width(<span class="hljs-number">512</span>)
    .height(<span class="hljs-number">350</span>)
    .render();
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.BrandsEyeMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        <span class="hljs-keyword">this</span>.query = options.query;
        <span class="hljs-keyword">this</span>.type = options.type;
        <span class="hljs-keyword">this</span>.__proto__ = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.type;

        <span class="hljs-keyword">var</span> chart = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">var</span> dataTransform = options.dataTransform || _.identity;

        <span class="hljs-keyword">this</span>.run = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span> {</span>
            brandseye.charts.loadFromApi({
                key: options.query.key,
                account: options.query.account,
                filter: options.query.filter,
                groupby: options.query.groupby,
                orderby: options.query.orderby,
                include: options.query.include,
                max: options.query.max,
                xFieldName: options.query.xFieldName,
                fragment: options.query.fragment,
                <span class="hljs-built_in">arguments</span>: options.query.arguments,

                success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
                    data = dataTransform(data);
                    chart.data(data);
                    callback(chart, data);
                }
            });
        };

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <h3 id="showing-volumes">Showing volumes</h3>

            </div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>This displays a histogram showing the number of mentions
received in a given time period.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.VolumeMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                key: options.key,
                groupby: <span class="hljs-string">"published"</span>
            },
            type: options.type || namespace.Histogram
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.published; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.count; })
            .dataAxisLabel(<span class="hljs-string">"Volume"</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <h3 id="opportunity-to-see">Opportunity-to-see</h3>

            </div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>This displays a histogram showing the OTS over a given time period.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.OtsMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                include: <span class="hljs-string">'ots'</span>,
                key: options.key,
                groupby: <span class="hljs-string">"published"</span>
            },
            type: options.type || namespace.Histogram
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.published; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.ots; })
            .dataAxisLabel({long: <span class="hljs-string">"Opportunity to see"</span>, short: <span class="hljs-string">"OTS"</span>});

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <h3 id="advert-value-equivalent">Advert-value-equivalent</h3>

            </div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>This displays a histogram showing the AVE over a given time period. These values
are by default in Rands (ZAR).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.AveMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                include: <span class="hljs-string">'ave'</span>,
                key: options.key,
                groupby: <span class="hljs-string">"published"</span>
            },
            type: options.type || namespace.Histogram
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.published; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.ave; })
            .dataAxisLabel({long: <span class="hljs-string">"Ad-value equivalent"</span>, short: <span class="hljs-string">"AVE"</span>});

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <h3 id="engagement">Engagement</h3>

            </div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>This displays a histogram showing a breakdown of engagement over time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.EngagementMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                include: <span class="hljs-string">'engagement'</span>,
                key: options.key,
                groupby: <span class="hljs-string">"published"</span>
            },
            type: options.type || namespace.Histogram
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.published; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.engagement; })
            .dataAxisLabel({long: <span class="hljs-string">"Engagement"</span>, short: <span class="hljs-string">"Engagement"</span>});

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <h3 id="categories">Categories</h3>

            </div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Shows a column chart breaking showing the distribution of mentions between
different categories of:</p>
<ul>
<li>press</li>
<li>enterprise</li>
<li>consumer</li>
<li>directory</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.CategoryMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                key: options.key,
                groupby: <span class="hljs-string">"media"</span>,
                include: <span class="hljs-string">"percentages"</span>,
                orderby: <span class="hljs-string">"count desc"</span>
            },
            type: options.type || namespace.ColumnChart
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.media; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.percentage; })
            .showLabels(<span class="hljs-literal">true</span>)
            .xAxisOverride({
                <span class="hljs-string">"PRESS"</span>: <span class="hljs-string">"Press"</span>,
                <span class="hljs-string">"CONSUMER"</span>: <span class="hljs-string">"Consumer"</span>,
                <span class="hljs-string">"ENTERPRISE"</span>: <span class="hljs-string">"Enterprise"</span>,
                <span class="hljs-string">"DIRECTORY"</span>: <span class="hljs-string">"Directory"</span>,
                <span class="hljs-string">"UNKNOWN"</span>: <span class="hljs-string">"Unknown"</span>
            })
            .labelFormat(brandseye.utilities.formatPercentage)
            .dataAxisLabel(<span class="hljs-string">"% of mentions by category"</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <h3 id="countries">Countries</h3>

            </div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Shows a break down of volume by country.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.CountryMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                key: options.key,
                include: <span class="hljs-string">"percentages"</span>,
                groupby: <span class="hljs-string">"country"</span>,
                orderby: <span class="hljs-string">"count desc"</span>,
                max: <span class="hljs-number">8</span>,
                xFieldName: <span class="hljs-string">"countryName"</span>
            },
            type: options.type || namespace.BarChart
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.countryName || d.country; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.percentage; })
            .showLabels(<span class="hljs-literal">true</span>)
            .labelFormat(brandseye.utilities.formatPercentage)
            .dataAxisLabel(<span class="hljs-string">"% of mentions by country"</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <h3 id="language">Language</h3>

            </div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Shows a break down of volume by language</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.LanguageMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                key: options.key,
                include: <span class="hljs-string">"percentages"</span>,
                groupby: <span class="hljs-string">"language"</span>,
                orderby: <span class="hljs-string">"count desc"</span>,
                max: <span class="hljs-number">8</span>,
                xFieldName: <span class="hljs-string">"languageName"</span>
            },
            type: options.type || namespace.BarChart
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.languageName || d.language; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.percentage; })
            .showLabels(<span class="hljs-literal">true</span>)
            .labelFormat(brandseye.utilities.formatPercentage)
            .dataAxisLabel(<span class="hljs-string">"% of mentions by language"</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <h3 id="gender">Gender</h3>

            </div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>Shows a break down of volume by gender.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.GenderMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                key: options.key,
                include: <span class="hljs-string">"percentages"</span>,
                groupby: <span class="hljs-string">"gender"</span>,
                orderby: <span class="hljs-string">"count desc"</span>
            },
            type: options.type || namespace.BarChart
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.gender; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.percentage; })
            .showLabels(<span class="hljs-literal">true</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>The API doesn’t return very displayed names for the gender options.
Here we override how they should be displayed, just to neaten them up
somewhat.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .xAxisOverride({
                <span class="hljs-string">"FEMALE"</span>: <span class="hljs-string">"Female"</span>,
                <span class="hljs-string">"MALE"</span>: <span class="hljs-string">"Male"</span>,
                <span class="hljs-string">"OTHER"</span>: <span class="hljs-string">"Other"</span>,
                <span class="hljs-string">"UNKNOWN"</span>: <span class="hljs-string">"Unknown"</span>

            })
            .labelFormat(brandseye.utilities.formatPercentage)
            .dataAxisLabel(<span class="hljs-string">"% of mentions by gender"</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <h3 id="sentiment">Sentiment</h3>

            </div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>Volume by sentiment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.SentimentMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                key: options.key,
                include: <span class="hljs-string">"percentages"</span>,
                groupby: <span class="hljs-string">"sentiment"</span>,
                orderby: <span class="hljs-string">"sentiment"</span>
            },
            type: options.type || namespace.BarChart
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.sentimentName || d.sentiment; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.percentage; })
            .showLabels(<span class="hljs-literal">true</span>)
            .labelFormat(brandseye.utilities.formatPercentage)
            .dataAxisLabel(<span class="hljs-string">"% of mentions by sentiment"</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <h3 id="sources">Sources</h3>

            </div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>The top sources that mentions come from</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.SourceMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                key: options.key,
                include: <span class="hljs-string">"percentages"</span>,
                groupby: <span class="hljs-string">"site"</span>,
                orderby: <span class="hljs-string">"count desc"</span>,
                max: <span class="hljs-number">6</span>,
                xFieldName: <span class="hljs-string">"site"</span>
            },
            type: options.type || namespace.PieChart
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.site; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.percentage; })
            .showLabels(<span class="hljs-literal">true</span>)
            .labelFormat(brandseye.utilities.formatPercentage)
            .dataAxisLabel(<span class="hljs-string">"% of mentions by source"</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <h3 id="mentions-by-author">Mentions by author</h3>

            </div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Mention volumes broken down by author.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.AuthorMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                account: options.account,
                key: options.key,
                include: <span class="hljs-string">"percentages"</span>,
                groupby: <span class="hljs-string">"authorName"</span>,
                orderby: <span class="hljs-string">"count desc"</span>,
                max: <span class="hljs-number">6</span>,
                xFieldName: <span class="hljs-string">"authorName"</span>
            },
            type: options.type || namespace.ColumnChart
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.authorName; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.percentage; })
            .showLabels(<span class="hljs-literal">true</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Here we only override a single option: the UNKNOWN
author is made to print prettier. Notice that you don’t
need to override everything, but can selectively do so.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            .xAxisOverride({
                <span class="hljs-string">"UNKNOWN"</span>: <span class="hljs-string">"Unknown"</span>
            })
            .labelFormat(brandseye.utilities.formatPercentage)
            .dataAxisLabel(<span class="hljs-string">"% of mentions by source"</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <h3 id="reputation">Reputation</h3>

            </div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>A line chart showing the basic reputation of the brand.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.ReputationMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                key: options.key,
                fragment: <span class="hljs-string">"rest/accounts/"</span> + options.account + <span class="hljs-string">"/score"</span>,
                <span class="hljs-built_in">arguments</span>: {
                    rootsOnly: <span class="hljs-literal">true</span>
                }
            },
            type: options.type || namespace.LineChart,
            dataTransform: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
                data = _(data).chain()
                    .groupBy(<span class="hljs-string">'brandId'</span>)
                    .values()
                    .filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
                        <span class="hljs-keyword">return</span> !data[<span class="hljs-number">0</span>].deleted;
                    })
                    .map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
                        <span class="hljs-keyword">return</span> {
                            key: data[<span class="hljs-number">0</span>].brand,
                            values: data
                        }
                    })
                    .value();
                <span class="hljs-keyword">return</span> data;
            }
        });

        <span class="hljs-keyword">this</span>
            .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.date; })
            .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.score; })
            .showLabels(<span class="hljs-literal">true</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <h3 id="a-word-cloud">A word cloud</h3>

            </div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Shows the distribution of words in selected mentions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.WordCloudMetric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
        namespace.BrandsEyeMetric.call(<span class="hljs-keyword">this</span>, {
            query: {
                filter: options.filter,
                key: options.key,
                fragment: <span class="hljs-string">"rest/accounts/"</span> + options.account + <span class="hljs-string">"/mentions/words"</span>,
                <span class="hljs-built_in">arguments</span>: {
                    rootsOnly: <span class="hljs-literal">true</span>,
                    limit: <span class="hljs-number">100</span>
                }
            },
            type: options.type || namespace.WordCloudChart,
            dataTransform: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
                <span class="hljs-keyword">return</span> data.data;
            }
        });

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p><a id="appendix"></a></p>
<h2 id="appendix-various-helper-objects">Appendix: various helper objects</h2>

            </div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <h3 id="drawing-labels">Drawing labels</h3>

            </div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>This places labels on the data items of a chart, such as the bars on a bar chart.
Currently this supports row and column charts, by
setting the <strong>position()</strong> field to be ‘rows’ or ‘columns’. You can also format
how the label will appear by setting the format function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.chartLabel = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

        <span class="hljs-keyword">var</span> x,
            y,
            xScale,
            yScale,
            delay,
            width,
            height,
            format = _.identity,
            position = <span class="hljs-string">"columns"</span>,
            scale = <span class="hljs-literal">false</span>,
            determineCompression,
            showLabels = <span class="hljs-literal">true</span>,
            duration = <span class="hljs-number">500</span>,
            originalSelection,
            zeroOpacity = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>The function that does the actual rendering of the labels. It takes
a D3 selection and returns itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span><span class="hljs-params">(selection)</span> {</span>
            originalSelection = selection;

            selection.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
                <span class="hljs-keyword">if</span> (data &amp;&amp; data.length &amp;&amp; !data[<span class="hljs-number">0</span>].values) data = [ {values: data} ];
                <span class="hljs-keyword">var</span> length = data ? data.length : <span class="hljs-number">1</span>;

                <span class="hljs-keyword">var</span> yDiff = -<span class="hljs-number">8</span>;             <span class="hljs-comment">// Space between label and bar.</span>
                <span class="hljs-keyword">var</span> slideDiff = -<span class="hljs-number">15</span>;        <span class="hljs-comment">// The space that new labels slide in over.</span>
                <span class="hljs-keyword">var</span> anchor = <span class="hljs-string">'middle'</span>;      <span class="hljs-comment">// Where text is anchored to relative to its length.</span>
                <span class="hljs-keyword">var</span> baseline = <span class="hljs-string">'auto'</span>;      <span class="hljs-comment">// Where text is anchored relative to its height.</span>
                <span class="hljs-keyword">var</span> getY = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    <span class="hljs-keyword">return</span> yScale(y(d)) + yDiff;
                };
                <span class="hljs-keyword">var</span> getX = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i, j)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>We are attempting to fit the label in the middle of its bar, or its section
of the bar if there are series.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> xScale(x(d)) + (j * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>) * xScale.rangeBand() / (<span class="hljs-number">2</span> * length);
                };</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Here we set things up slightly differently for handling rows.
The default values above handle columns.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (position == <span class="hljs-string">'rows'</span>) {
                    <span class="hljs-keyword">var</span> tmp = getY;
                    getY = getX;
                    getX = tmp;

                    anchor = <span class="hljs-string">'start'</span>;
                    yDiff = -yDiff;
                    baseline = <span class="hljs-string">'central'</span>;
                }

                <span class="hljs-keyword">if</span> (data) {</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Labels are divided into planes, one plane of comment per series of data.
Here we add and remove planes as necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> labelPlanes = d3.select(<span class="hljs-keyword">this</span>).select(<span class="hljs-string">'.nv-wrap'</span>).selectAll(<span class="hljs-string">'.label-plane'</span>).data(data);
                    labelPlanes.exit().remove();
                    labelPlanes.enter().append(<span class="hljs-string">'g'</span>)
                        .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'label-plane'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>Labels occur on a plane. Here we subselect data from a plane. We then add and remove labels
as necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> labels = labelPlanes
                        .selectAll(<span class="hljs-string">'.chart-label'</span>)
                        .data(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.values; });
                    labels.exit().remove();</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Add new ‘blank’ labels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    labels.style(<span class="hljs-string">'opacity'</span>, zeroOpacity);
                    labels.enter().append(<span class="hljs-string">'text'</span>)
                        .classed(<span class="hljs-string">'chart-label'</span>, <span class="hljs-literal">true</span>)
                        .attr(<span class="hljs-string">'text-anchor'</span>, anchor)
                        .attr(<span class="hljs-string">'dx'</span>, slideDiff)
                        .attr(<span class="hljs-string">'dominant-baseline'</span>, baseline)
                        .style(<span class="hljs-string">'opacity'</span>, zeroOpacity)
                        .transition()
                        .delay(<span class="hljs-number">500</span>)
                        .duration(duration)
                        .attr(<span class="hljs-string">'dx'</span>, <span class="hljs-number">0</span>);

                    <span class="hljs-keyword">if</span> (position === <span class="hljs-string">'circle'</span>) setupCircleLabels(labels)
                    <span class="hljs-keyword">else</span> setupBarLabels(labels, length, getX, getY, anchor, yDiff);</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Hide them or animate them fading in.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    labels
                        .transition()
                        .delay(<span class="hljs-number">750</span>)
                        .duration(duration)
                        .style(<span class="hljs-string">'opacity'</span>, showLabels ? <span class="hljs-number">1</span> : zeroOpacity);
                }
            });

            <span class="hljs-keyword">return</span> draw;
        }


        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupCircleLabels</span><span class="hljs-params">(labels)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>Calculate beginning and end angles.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> pie = d3.layout.pie()
                .sort(<span class="hljs-literal">null</span>)
                .value(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> y(d); })
            <span class="hljs-keyword">var</span> radius = (<span class="hljs-built_in">Math</span>.min(width, height) / <span class="hljs-number">2</span>) * <span class="hljs-number">0.85</span>;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calcAngle</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">return</span> (d.endAngle - d.startAngle) / <span class="hljs-number">2.0</span> + d.startAngle;
            }

            labels.data(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> pie(d.values); });
            labels
                .each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    d.angle = calcAngle(d);
                })
                .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Anchor depends on the side of the pie that the text appears on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (d.angle &lt; <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">8</span> || d.angle &gt; <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI - <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">8</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'middle'</span>;
                    <span class="hljs-keyword">if</span> ((d.angle &gt; (<span class="hljs-built_in">Math</span>.PI - <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">8</span>)) &amp;&amp; (d.angle &lt; (<span class="hljs-built_in">Math</span>.PI + <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">8</span>))) <span class="hljs-keyword">return</span> <span class="hljs-string">'middle'</span>;
                    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> &lt; d.angle &amp;&amp; d.angle &lt; <span class="hljs-built_in">Math</span>.PI ? <span class="hljs-string">"start"</span> : <span class="hljs-string">"end"</span>;
                })
                .style(<span class="hljs-string">'dominant-baseline'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>We want labels on the bottom half of the pie chart to hang,
and those on the top to use their lower baseline.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> ((d.angle &gt; (<span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">8</span> + <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">2</span>)) &amp;&amp; (d.angle &lt; (<span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI - <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">8</span> - <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">2</span>))) <span class="hljs-keyword">return</span> <span class="hljs-string">'hanging'</span>;
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">2</span> &lt; d.angle &amp;&amp; d.angle &lt; <span class="hljs-number">3</span>/<span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI ? <span class="hljs-string">'middle'</span> : <span class="hljs-string">'auto'</span>;
                })
                .text(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    <span class="hljs-keyword">var</span> angle = (d.endAngle - d.startAngle);
                    <span class="hljs-keyword">return</span> angle &gt; <span class="hljs-number">0.15</span> ? format(y(d.data)) : <span class="hljs-string">''</span>;
                })
                .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    <span class="hljs-keyword">var</span> xPos  = radius * <span class="hljs-built_in">Math</span>.cos(d.angle  - <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">2.0</span>),
                        yPos  = radius * <span class="hljs-built_in">Math</span>.sin(d.angle  - <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">2.0</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-string">'translate ('</span> + (xPos + width/<span class="hljs-number">2</span>) + <span class="hljs-string">', '</span> + (yPos + height/<span class="hljs-number">2</span>) + <span class="hljs-string">')'</span>;
                });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>This is used to determine if we should scale text.
If we are drawing series data, the range should be contracted a bit.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateRangeBuffer</span><span class="hljs-params">(length)</span> {</span>
            <span class="hljs-keyword">return</span> length &gt; <span class="hljs-number">1</span> ? <span class="hljs-number">0.95</span> : <span class="hljs-number">1.05</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupBarLabels</span><span class="hljs-params">(labels, length, getX, getY, anchor, yDiff)</span> {</span>
            <span class="hljs-keyword">var</span> rangeBuffer = calculateRangeBuffer(length);

            <span class="hljs-keyword">var</span> rangeBand = xScale.rangeBand() * rangeBuffer,
                availableSpace = rangeBand / length,
                compression = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> (determineCompression) {
                labels.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                    <span class="hljs-keyword">var</span> tmp = determineCompression(y(d), availableSpace);
                    <span class="hljs-keyword">if</span> (compression == <span class="hljs-literal">null</span> || tmp &gt; compression) compression = tmp;
                });
            }

            labels
                .text(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> format(y(d), compression); })
                .classed(<span class="hljs-string">'small-label'</span>, <span class="hljs-literal">false</span>)  <span class="hljs-comment">// Need to make sure this is removed, so that we get proper sizing.</span>
                .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>We have enough space to flip the text into the bar.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (d.toString().length * <span class="hljs-number">8</span> &lt; getX(d)) <span class="hljs-keyword">return</span> <span class="hljs-string">'end'</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> anchor;
                })
                .attr(<span class="hljs-string">'x'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Text has been flipped. Shift it slightly the other way.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (d.toString().length * <span class="hljs-number">8</span> &lt; getX(d)) <span class="hljs-keyword">return</span> getX.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>) - <span class="hljs-number">2</span> * yDiff;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> getX.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
                })
                .attr(<span class="hljs-string">'y'</span>, getY);</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>Now that the labels have their text set, lets scale
them to fit the rangeBand.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> removeLabels = _.once(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> remove = <span class="hljs-literal">false</span>;
                labels.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">if</span> (!remove) {
                        <span class="hljs-keyword">var</span> bounds = <span class="hljs-keyword">this</span>.getBBox();
                        <span class="hljs-keyword">var</span> size = position == <span class="hljs-string">"columns"</span> ? bounds.width : bounds.height;
                        remove = remove || size &gt; availableSpace;
                    }
                });
                <span class="hljs-keyword">if</span> (remove) labels.remove();
            });

            <span class="hljs-keyword">if</span> (scale) {
                _.delay(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>An initial pass to see if we should shrink text. The visibility
test is to ensure we don’t have an NS_ERROR_FAILURE on requesting the bounding box.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> shrink = <span class="hljs-literal">false</span>;
                    labels.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">if</span> (!shrink &amp;&amp; $(<span class="hljs-keyword">this</span>).is(<span class="hljs-string">':visible'</span>)) {
                            <span class="hljs-keyword">var</span> bounds = <span class="hljs-keyword">this</span>.getBBox();
                            shrink = shrink || bounds.width &gt; availableSpace;
                        }
                    });
                    labels.classed(<span class="hljs-string">'small-label'</span>, shrink);

                    removeLabels();
                }, <span class="hljs-number">500</span>);
            }
            <span class="hljs-keyword">else</span> {
                removeLabels();
            }
        }

        draw.show = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            d3.select(originalSelection.node())
                .selectAll(<span class="hljs-string">'.chart-label'</span>)
                .transition()
                .duration(duration)
                .style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">1</span>);

        };

        draw.hide = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(time)</span> {</span>
            <span class="hljs-keyword">if</span> (_(time).isUndefined()) time = duration;
            d3.select(originalSelection.node())
                .selectAll(<span class="hljs-string">'.chart-label'</span>)
                .transition()
                .duration(time)
                .style(<span class="hljs-string">'opacity'</span>, zeroOpacity);
        };

        draw.isSpaceForLabels = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            originalSelection.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
                <span class="hljs-keyword">if</span> (!data) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

                <span class="hljs-keyword">var</span> length = data.length,
                    availableSpace = calculateRangeBuffer(length) / length,
                    shrink = <span class="hljs-literal">false</span>;

                d3.select(<span class="hljs-keyword">this</span>).selectAll(<span class="hljs-string">'.chart-label'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">if</span> (!shrink) {
                        <span class="hljs-keyword">var</span> bounds = <span class="hljs-keyword">this</span>.getBBox();
                        shrink = shrink || bounds.width &gt; availableSpace;
                    }
                });
            });
        };

        draw.position = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> position;
            position = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.x = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> x;
            x = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.y = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> y;
            y = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.width = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> width;
            width = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.height = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> height;
            height = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.delay = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> delay;
            delay = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.xScale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> xScale;
            xScale = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.yScale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> yScale;
            yScale = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.zeroOpacity = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> zeroOpacity;
            zeroOpacity = _;
            <span class="hljs-keyword">return</span> draw;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Passes two possible arguments. The first is the data that should be formatted. The second
is an indiciation of the amount of compression that should occur, as determined by the
determineCompression function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        draw.format = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> format;
            format = _;
            <span class="hljs-keyword">return</span> draw;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>This function should return a numeric indication of how much compression the label format
should incur. This number needs to be meaningful only to the label format function.
Larger numbers, however, should mean smaller compression.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        draw.determineCompression = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> determineCompression;
            determineCompression = _;
            <span class="hljs-keyword">return</span> draw;
        };

        <span class="hljs-comment">/*
         * Whether we should scale labels to fit.
         */</span>
        draw.scale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> scale;
            scale = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.showLabels = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> showLabels;
            showLabels = _;
            <span class="hljs-keyword">return</span> draw;
        };

        <span class="hljs-keyword">return</span> draw;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <h3 id="drawing-chart-legends">Drawing chart legends</h3>

            </div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>This determines the amount of space required for a legend, and also
renders that legend.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    namespace.chartLegend = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

        <span class="hljs-keyword">var</span> margin = {top: <span class="hljs-number">0</span>, left: <span class="hljs-number">0</span>, right: <span class="hljs-number">180</span>},
            colours,
            finalHeight = <span class="hljs-number">0</span>,
            width,
            height,
            data,
            forceLegend,
            showLegend = <span class="hljs-literal">true</span>,
            zeroOpacity = <span class="hljs-number">0</span>;


        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span><span class="hljs-params">(selection)</span> {</span>

            <span class="hljs-keyword">var</span> padding = <span class="hljs-number">10</span>;
            <span class="hljs-keyword">var</span> afterRectPadding = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">var</span> bottomPadding = <span class="hljs-number">5</span>;
            <span class="hljs-keyword">var</span> topPadding = <span class="hljs-number">15</span>;
            <span class="hljs-keyword">var</span> lineHeight = <span class="hljs-number">10</span>;
            <span class="hljs-keyword">var</span> interLinePadding = <span class="hljs-number">5</span>;
            <span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>;

            selection.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-keyword">if</span> (d) {
                    <span class="hljs-keyword">var</span> legend = d3.select(<span class="hljs-keyword">this</span>).selectAll(<span class="hljs-string">'.legend'</span>).data([data || d]);

                    <span class="hljs-keyword">if</span> ((!forceLegend &amp;&amp; (data || d).length &lt;= <span class="hljs-number">1</span>) || !showLegend) {
                        finalHeight = <span class="hljs-number">0</span>;
                        legend.remove();
                        <span class="hljs-keyword">return</span>;
                    }

                    legend.enter()
                        .append(<span class="hljs-string">'g'</span>)
                        .classed(<span class="hljs-string">'legend'</span>, <span class="hljs-literal">true</span>);
                    legend.exit().remove();

                    <span class="hljs-keyword">var</span> entries = legend.selectAll(<span class="hljs-string">'.legend-entry'</span>).data(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d; });
                    entries.exit().remove();

                    <span class="hljs-keyword">var</span> newEntries = entries.enter();
                    newEntries.append(<span class="hljs-string">'g'</span>)
                        .classed(<span class="hljs-string">'legend-entry'</span>, <span class="hljs-literal">true</span>)
                        .on(<span class="hljs-string">'mouseover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i)</span> {</span>  <span class="hljs-comment">// This highlights the item that we are mousing over.</span></pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>The selection object seems to have been damaged here. If we only use the original
selection, then d3 begins to complain about undefined functions. So we reselect
the element that it was pointing to.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">var</span> s = d3.select(selection.node());
                            s.selectAll(<span class="hljs-string">'.nv-slice'</span>)
                                .classed(<span class="hljs-string">'bar-fade'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.data.legendKey != i; });

                            s.selectAll(<span class="hljs-string">'.nv-bar'</span>)
                                .classed(<span class="hljs-string">'bar-fade'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.legendKey != i; })
                                .classed(<span class="hljs-string">'bar-highlight'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span> <span class="hljs-keyword">return</span> d.legendKey == i; });

                            s.selectAll(<span class="hljs-string">'.chart-label'</span>)
                                .classed(<span class="hljs-string">'bar-fade'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> {</span>
                                    <span class="hljs-keyword">if</span> (d.data) <span class="hljs-keyword">return</span> d.data.legendKey != i;
                                    <span class="hljs-keyword">return</span> d.legendKey != i;
                                });
                        })
                        .on(<span class="hljs-string">'mouseout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i)</span> {</span>
                            <span class="hljs-keyword">var</span> s = d3.select(selection.node());
                            s.selectAll(<span class="hljs-string">'.nv-slice'</span>)
                                .classed(<span class="hljs-string">'bar-highlight'</span>, <span class="hljs-literal">false</span>)
                                .classed(<span class="hljs-string">'bar-fade'</span>, <span class="hljs-literal">false</span>);
                            s.selectAll(<span class="hljs-string">'.nv-bar'</span>)
                                .classed(<span class="hljs-string">'bar-highlight'</span>, <span class="hljs-literal">false</span>)
                                .classed(<span class="hljs-string">'bar-fade'</span>, <span class="hljs-literal">false</span>);
                            s.selectAll(<span class="hljs-string">'.chart-label'</span>)
                                .classed(<span class="hljs-string">'bar-fade'</span>, <span class="hljs-literal">false</span>);
                        })
                        .each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                            <span class="hljs-keyword">var</span> item = d3.select(<span class="hljs-keyword">this</span>);
                            item
                                .append(<span class="hljs-string">'rect'</span>)
                                .attr(<span class="hljs-string">'width'</span>, <span class="hljs-number">10</span>)
                                .attr(<span class="hljs-string">'height'</span>, <span class="hljs-number">10</span>)
                                .attr(<span class="hljs-string">'rx'</span>, <span class="hljs-number">2</span>)
                                .attr(<span class="hljs-string">'ry'</span>, <span class="hljs-number">2</span>);
                            item
                                .append(<span class="hljs-string">'text'</span>)
                                .attr(<span class="hljs-string">'dx'</span>, <span class="hljs-number">10</span> + afterRectPadding)
                                .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-number">10</span>);
                            item
                                .append(<span class="hljs-string">'title'</span>);
                        })
                        .style(<span class="hljs-string">'opacity'</span>, zeroOpacity)
                        .transition()
                        .duration(<span class="hljs-number">750</span>)
                        .style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">1</span>);

                    entries.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i)</span> {</span>
                        d3.select(<span class="hljs-keyword">this</span>)
                            .select(<span class="hljs-string">'rect'</span>)
                            .style(<span class="hljs-string">'fill'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (colours) <span class="hljs-keyword">return</span> d.color || colours[i % colours.length];
                                <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> d.color || <span class="hljs-string">'black'</span>;
                            });
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>This index and odd data indexing is needed because d3 is only returning an index of 0, and has not
properly updated the data for these subelements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
                    entries.selectAll(<span class="hljs-string">'text'</span>)
                        .text(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> xAxisTickFormat(<span class="hljs-number">30</span>, brandseye.utilities.removeQuotes((data || d)[index++].key.toString())); });

                    index = <span class="hljs-number">0</span>;
                    entries.selectAll(<span class="hljs-string">'title'</span>)
                        .text(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> brandseye.utilities.removeQuotes((data || d)[index++].key.toString()); });</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>Now we want to lay out the legend in columns. So we will
first determine the longest entry.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> maxWidth = <span class="hljs-number">0</span>;
                    entries.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">var</span> width = d3.select(<span class="hljs-keyword">this</span>).node().getBBox().width;
                        <span class="hljs-keyword">if</span> (width &gt; maxWidth) maxWidth = width;
                    });

                    maxWidth += padding;

                    <span class="hljs-keyword">var</span> availableWidth = width - margin.left;
                    <span class="hljs-keyword">var</span> numColumns = <span class="hljs-built_in">Math</span>.floor(availableWidth / maxWidth);
                    maxWidth += <span class="hljs-built_in">Math</span>.floor((availableWidth % maxWidth) / numColumns) <span class="hljs-comment">// Divide the left over space between the items.</span>

                    <span class="hljs-keyword">if</span> (maxWidth === <span class="hljs-literal">Infinity</span>) maxWidth = width;

                    <span class="hljs-keyword">var</span> currentColumn = <span class="hljs-number">0</span>;
                    entries
                        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i)</span> {</span>
                            <span class="hljs-keyword">var</span> currentX = currentColumn * maxWidth,
                                currentY = y;

                            currentColumn += <span class="hljs-number">1</span>;
                            <span class="hljs-keyword">if</span> (currentColumn &gt;= numColumns) {
                                currentColumn = <span class="hljs-number">0</span>;
                                y = y + lineHeight + interLinePadding;
                            }

                            <span class="hljs-keyword">return</span> <span class="hljs-string">'translate ('</span> + currentX + <span class="hljs-string">','</span> + currentY + <span class="hljs-string">')'</span>;
                        });

                    finalHeight = y + lineHeight + bottomPadding;
                    legend
                        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'translate('</span> + margin.left + <span class="hljs-string">','</span> + (height - finalHeight) + <span class="hljs-string">')'</span>);
                    finalHeight += topPadding;
                }
            });

            <span class="hljs-keyword">return</span> draw;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
        draw.margin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> margin;
            margin = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.colours = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> colours;
            colours = _.concat(brandseye.colours.allColours);
            <span class="hljs-keyword">return</span> draw;
        };

        draw.finalHeight = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">return</span> finalHeight;
        };

        draw.width = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> width;
            width = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.height = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> height;
            height = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.data = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> data;
            data = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.showLegend = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> showLegend;
            showLegend = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.forceLegend = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> forceLegend;
            forceLegend = _;
            <span class="hljs-keyword">return</span> draw;
        };

        draw.zeroOpacity = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> zeroOpacity;
            zeroOpacity = _;
            <span class="hljs-keyword">return</span> draw;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">return</span> draw;
    };

    <span class="hljs-keyword">return</span> namespace;
}();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
